(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();function mo(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var e=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),e}var Oe={},X=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class go{constructor(t){this.messageBus=t}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return X(this,void 0,void 0,function*(){const{selection:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return t})}select(t,e){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:t,replace:e})})}deselect(t){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:t})})}getName(){return X(this,void 0,void 0,function*(){const{name:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return t})}setName(t){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:t})})}getColor(){return X(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return t})}setColor(t){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:t})})}getSyncView(){return X(this,void 0,void 0,function*(){const{syncView:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return t})}setSyncView(t){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:t})})}getId(){return X(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return t})}getRole(){return X(this,void 0,void 0,function*(){const{role:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return t})}getMetadata(){return X(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return t})}setMetadata(t){return X(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:t})})}hasPermission(t){return X(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:i}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return i.indexOf(t)>-1})}getConnectionId(){return X(this,void 0,void 0,function*(){const{connectionId:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return t})}onChange(t){const e=i=>{t(i.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",e)}}}var lt=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class Eo{constructor(t){this.messageBus=t}reset(){return lt(this,void 0,void 0,function*(){const{transform:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return t})}animateTo(t){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:t})})}animateToBounds(t){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:t})})}getPosition(){return lt(this,void 0,void 0,function*(){const{position:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return t})}setPosition(t){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:t})})}getScale(){return lt(this,void 0,void 0,function*(){const{scale:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return t})}setScale(t){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:t})})}getWidth(){return lt(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return t})}getHeight(){return lt(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return t})}transformPoint(t){return lt(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:t});return e})}inverseTransformPoint(t){return lt(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:t});return e})}}function xo(n){return typeof n.id=="string"}var mn={exports:{}},cs;function Ao(){if(cs)return mn.exports;cs=1;var n=typeof Reflect=="object"?Reflect:null,t=n&&typeof n.apply=="function"?n.apply:function(g,x,T){return Function.prototype.apply.call(g,x,T)},e;n&&typeof n.ownKeys=="function"?e=n.ownKeys:Object.getOwnPropertySymbols?e=function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:e=function(g){return Object.getOwnPropertyNames(g)};function i(y){console&&console.warn&&console.warn(y)}var r=Number.isNaN||function(g){return g!==g};function s(){s.init.call(this)}mn.exports=s,mn.exports.once=C,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");o=y}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(g){if(typeof g!="number"||g<0||r(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this};function c(y){return y._maxListeners===void 0?s.defaultMaxListeners:y._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(g){for(var x=[],T=1;T<arguments.length;T++)x.push(arguments[T]);var v=g==="error",B=this._events;if(B!==void 0)v=v&&B.error===void 0;else if(!v)return!1;if(v){var w;if(x.length>0&&(w=x[0]),w instanceof Error)throw w;var N=new Error("Unhandled error."+(w?" ("+w.message+")":""));throw N.context=w,N}var xt=B[g];if(xt===void 0)return!1;if(typeof xt=="function")t(xt,this,x);else for(var ie=xt.length,ge=p(xt,ie),T=0;T<ie;++T)t(ge[T],this,x);return!0};function l(y,g,x,T){var v,B,w;if(a(x),B=y._events,B===void 0?(B=y._events=Object.create(null),y._eventsCount=0):(B.newListener!==void 0&&(y.emit("newListener",g,x.listener?x.listener:x),B=y._events),w=B[g]),w===void 0)w=B[g]=x,++y._eventsCount;else if(typeof w=="function"?w=B[g]=T?[x,w]:[w,x]:T?w.unshift(x):w.push(x),v=c(y),v>0&&w.length>v&&!w.warned){w.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+w.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=y,N.type=g,N.count=w.length,i(N)}return y}s.prototype.addListener=function(g,x){return l(this,g,x,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(g,x){return l(this,g,x,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(y,g,x){var T={fired:!1,wrapFn:void 0,target:y,type:g,listener:x},v=u.bind(T);return v.listener=x,T.wrapFn=v,v}s.prototype.once=function(g,x){return a(x),this.on(g,d(this,g,x)),this},s.prototype.prependOnceListener=function(g,x){return a(x),this.prependListener(g,d(this,g,x)),this},s.prototype.removeListener=function(g,x){var T,v,B,w,N;if(a(x),v=this._events,v===void 0)return this;if(T=v[g],T===void 0)return this;if(T===x||T.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete v[g],v.removeListener&&this.emit("removeListener",g,T.listener||x));else if(typeof T!="function"){for(B=-1,w=T.length-1;w>=0;w--)if(T[w]===x||T[w].listener===x){N=T[w].listener,B=w;break}if(B<0)return this;B===0?T.shift():f(T,B),T.length===1&&(v[g]=T[0]),v.removeListener!==void 0&&this.emit("removeListener",g,N||x)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(g){var x,T,v;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[g]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[g]),this;if(arguments.length===0){var B=Object.keys(T),w;for(v=0;v<B.length;++v)w=B[v],w!=="removeListener"&&this.removeAllListeners(w);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=T[g],typeof x=="function")this.removeListener(g,x);else if(x!==void 0)for(v=x.length-1;v>=0;v--)this.removeListener(g,x[v]);return this};function _(y,g,x){var T=y._events;if(T===void 0)return[];var v=T[g];return v===void 0?[]:typeof v=="function"?x?[v.listener||v]:[v]:x?A(v):p(v,v.length)}s.prototype.listeners=function(g){return _(this,g,!0)},s.prototype.rawListeners=function(g){return _(this,g,!1)},s.listenerCount=function(y,g){return typeof y.listenerCount=="function"?y.listenerCount(g):m.call(y,g)},s.prototype.listenerCount=m;function m(y){var g=this._events;if(g!==void 0){var x=g[y];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function p(y,g){for(var x=new Array(g),T=0;T<g;++T)x[T]=y[T];return x}function f(y,g){for(;g+1<y.length;g++)y[g]=y[g+1];y.pop()}function A(y){for(var g=new Array(y.length),x=0;x<g.length;++x)g[x]=y[x].listener||y[x];return g}function C(y,g){return new Promise(function(x,T){function v(w){y.removeListener(g,B),T(w)}function B(){typeof y.removeListener=="function"&&y.removeListener("error",v),x([].slice.call(arguments))}R(y,g,B,{once:!0}),g!=="error"&&S(y,v,{once:!0})})}function S(y,g,x){typeof y.on=="function"&&R(y,"error",g,x)}function R(y,g,x,T){if(typeof y.on=="function")T.once?y.once(g,x):y.on(g,x);else if(typeof y.addEventListener=="function")y.addEventListener(g,function v(B){T.once&&y.removeEventListener(g,v),x(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}return mn.exports}var To=Ao();let gn;const Oo=new Uint8Array(16);function vo(){if(!gn&&(gn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!gn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return gn(Oo)}const j=[];for(let n=0;n<256;++n)j.push((n+256).toString(16).slice(1));function Ro(n,t=0){return j[n[t+0]]+j[n[t+1]]+j[n[t+2]]+j[n[t+3]]+"-"+j[n[t+4]]+j[n[t+5]]+"-"+j[n[t+6]]+j[n[t+7]]+"-"+j[n[t+8]]+j[n[t+9]]+"-"+j[n[t+10]]+j[n[t+11]]+j[n[t+12]]+j[n[t+13]]+j[n[t+14]]+j[n[t+15]]}const Mo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),us={randomUUID:Mo};function Or(n,t,e){if(us.randomUUID&&!n)return us.randomUUID();n=n||{};const i=n.random||(n.rng||vo)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Ro(i)}class Co extends To.EventEmitter{constructor(t,e){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=i=>{const r=i.data;if(i.origin===this.targetOrigin&&xo(r)){if(r.id==="OBR_READY"){this.ready=!0;const s=r.data;this.ref=s.ref,this.userId=s.userId}this.emit(r.id,r.data)}},this.send=(i,r,s)=>{var o;if(!this.ref)throw Error("Unable to send message: not ready");(o=window.parent)===null||o===void 0||o.postMessage({id:i,data:r,ref:this.ref,nonce:s},this.targetOrigin)},this.sendAsync=(i,r,s=5e3)=>{const o=`_${Or()}`;return this.send(i,r,o),Promise.race([new Promise((a,c)=>{const l=this;function u(_){l.off(`${i}_RESPONSE${o}`,u),l.off(`${i}_ERROR${o}`,d),a(_)}function d(_){l.off(`${i}_RESPONSE${o}`,u),l.off(`${i}_ERROR${o}`,d),c(_)}this.on(`${i}_RESPONSE${o}`,u),this.on(`${i}_ERROR${o}`,d)}),...s>0?[new Promise((a,c)=>window.setTimeout(()=>c(new Error(`Message ${i} took longer than ${s}ms to get a result`)),s))]:[]])},this.roomId=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var ls=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class So{constructor(t){this.messageBus=t}show(t,e){return ls(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:t,variant:e});return i})}close(t){return ls(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:t})})}}var le=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class wo{constructor(t){this.messageBus=t}getColor(){return le(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return t})}setColor(t){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:t})})}getStrokeWidth(){return le(this,void 0,void 0,function*(){const{strokeWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return t})}setStrokeWidth(t){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:t})})}getFilled(){return le(this,void 0,void 0,function*(){const{filled:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return t})}setFilled(t){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:t})})}onChange(t){const e=i=>{t(i.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",e)}}}var W=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class bo{constructor(t){this.messageBus=t}getDpi(){return W(this,void 0,void 0,function*(){const{dpi:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return t})}getScale(){return W(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(t){return W(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:t})})}getColor(){return W(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return t})}setColor(t){return W(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:t})})}getOpacity(){return W(this,void 0,void 0,function*(){const{opacity:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return t})}setOpacity(t){return W(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:t})})}getType(){return W(this,void 0,void 0,function*(){const{type:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return t})}setType(t){return W(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:t})})}getLineType(){return W(this,void 0,void 0,function*(){const{lineType:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return t})}setLineType(t){return W(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:t})})}getMeasurement(){return W(this,void 0,void 0,function*(){const{measurement:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return t})}setMeasurement(t){return W(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:t})})}getLineWidth(){return W(this,void 0,void 0,function*(){const{lineWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_WIDTH",{});return t})}setLineWidth(t){return W(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_WIDTH",{lineWidth:t})})}snapPosition(t,e,i,r){return W(this,void 0,void 0,function*(){const{position:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:t,snappingSensitivity:e,useCorners:i,useCenter:r});return s})}getDistance(t,e){return W(this,void 0,void 0,function*(){const{distance:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:t,to:e});return i})}onChange(t){const e=i=>{t(i.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",e)}}}var En=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class Bo{constructor(t){this.messageBus=t}undo(){return En(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return En(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return En(this,void 0,void 0,function*(){const{canUndo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return t})}canRedo(){return En(this,void 0,void 0,function*(){const{canRedo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return t})}}var xi=Symbol.for("immer-nothing"),je=Symbol.for("immer-draftable"),it=Symbol.for("immer-state");function z(n,...t){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var Kt=Object.getPrototypeOf;function Zt(n){return!!n&&!!n[it]}function Lt(n){var t;return n?vr(n)||Array.isArray(n)||!!n[je]||!!((t=n.constructor)!=null&&t[je])||rn(n)||on(n):!1}var Io=Object.prototype.constructor.toString();function vr(n){if(!n||typeof n!="object")return!1;const t=Kt(n);if(t===null)return!0;const e=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return e===Object?!0:typeof e=="function"&&Function.toString.call(e)===Io}function Xe(n,t){Qt(n)===0?Reflect.ownKeys(n).forEach(e=>{t(e,n[e],n)}):n.forEach((e,i)=>t(i,e,n))}function Qt(n){const t=n[it];return t?t.type_:Array.isArray(n)?1:rn(n)?2:on(n)?3:0}function Ke(n,t){return Qt(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function zn(n,t){return Qt(n)===2?n.get(t):n[t]}function Rr(n,t,e){const i=Qt(n);i===2?n.set(t,e):i===3?n.add(e):n[t]=e}function No(n,t){return n===t?n!==0||1/n===1/t:n!==n&&t!==t}function rn(n){return n instanceof Map}function on(n){return n instanceof Set}function Wt(n){return n.copy_||n.base_}function ci(n,t){if(rn(n))return new Map(n);if(on(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const e=vr(n);if(t===!0||t==="class_only"&&!e){const i=Object.getOwnPropertyDescriptors(n);delete i[it];let r=Reflect.ownKeys(i);for(let s=0;s<r.length;s++){const o=r[s],a=i[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(i[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:n[o]})}return Object.create(Kt(n),i)}else{const i=Kt(n);if(i!==null&&e)return{...n};const r=Object.create(i);return Object.assign(r,n)}}function Ai(n,t=!1){return Nn(n)||Zt(n)||!Lt(n)||(Qt(n)>1&&(n.set=n.add=n.clear=n.delete=Po),Object.freeze(n),t&&Object.entries(n).forEach(([e,i])=>Ai(i,!0))),n}function Po(){z(2)}function Nn(n){return Object.isFrozen(n)}var ui={};function Jt(n){const t=ui[n];return t||z(0,n),t}function Do(n,t){ui[n]||(ui[n]=t)}var Ze;function Mr(){return Ze}function Lo(n,t){return{drafts_:[],parent_:n,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ds(n,t){t&&(Jt("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=t)}function li(n){di(n),n.drafts_.forEach($o),n.drafts_=null}function di(n){n===Ze&&(Ze=n.parent_)}function hs(n){return Ze=Lo(Ze,n)}function $o(n){const t=n[it];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function fs(n,t){t.unfinalizedDrafts_=t.drafts_.length;const e=t.drafts_[0];return n!==void 0&&n!==e?(e[it].modified_&&(li(t),z(4)),Lt(n)&&(n=wn(t,n),t.parent_||bn(t,n)),t.patches_&&Jt("Patches").generateReplacementPatches_(e[it].base_,n,t.patches_,t.inversePatches_)):n=wn(t,e,[]),li(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),n!==xi?n:void 0}function wn(n,t,e){if(Nn(t))return t;const i=t[it];if(!i)return Xe(t,(r,s)=>_s(n,i,t,r,s,e)),t;if(i.scope_!==n)return t;if(!i.modified_)return bn(n,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const r=i.copy_;let s=r,o=!1;i.type_===3&&(s=new Set(r),r.clear(),o=!0),Xe(s,(a,c)=>_s(n,i,r,a,c,e,o)),bn(n,r,!1),e&&n.patches_&&Jt("Patches").generatePatches_(i,e,n.patches_,n.inversePatches_)}return i.copy_}function _s(n,t,e,i,r,s,o){if(Zt(r)){const a=s&&t&&t.type_!==3&&!Ke(t.assigned_,i)?s.concat(i):void 0,c=wn(n,r,a);if(Rr(e,i,c),Zt(c))n.canAutoFreeze_=!1;else return}else o&&e.add(r);if(Lt(r)&&!Nn(r)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;wn(n,r),(!t||!t.scope_.parent_)&&typeof i!="symbol"&&Object.prototype.propertyIsEnumerable.call(e,i)&&bn(n,r)}}function bn(n,t,e=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&Ai(t,e)}function ko(n,t){const e=Array.isArray(n),i={type_:e?1:0,scope_:t?t.scope_:Mr(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=i,s=Ti;e&&(r=[i],s=Qe);const{revoke:o,proxy:a}=Proxy.revocable(r,s);return i.draft_=a,i.revoke_=o,a}var Ti={get(n,t){if(t===it)return n;const e=Wt(n);if(!Ke(e,t))return Uo(n,e,t);const i=e[t];return n.finalized_||!Lt(i)?i:i===Yn(n.base_,t)?(Xn(n),n.copy_[t]=fi(i,n)):i},has(n,t){return t in Wt(n)},ownKeys(n){return Reflect.ownKeys(Wt(n))},set(n,t,e){const i=Cr(Wt(n),t);if(i!=null&&i.set)return i.set.call(n.draft_,e),!0;if(!n.modified_){const r=Yn(Wt(n),t),s=r==null?void 0:r[it];if(s&&s.base_===e)return n.copy_[t]=e,n.assigned_[t]=!1,!0;if(No(e,r)&&(e!==void 0||Ke(n.base_,t)))return!0;Xn(n),hi(n)}return n.copy_[t]===e&&(e!==void 0||t in n.copy_)||Number.isNaN(e)&&Number.isNaN(n.copy_[t])||(n.copy_[t]=e,n.assigned_[t]=!0),!0},deleteProperty(n,t){return Yn(n.base_,t)!==void 0||t in n.base_?(n.assigned_[t]=!1,Xn(n),hi(n)):delete n.assigned_[t],n.copy_&&delete n.copy_[t],!0},getOwnPropertyDescriptor(n,t){const e=Wt(n),i=Reflect.getOwnPropertyDescriptor(e,t);return i&&{writable:!0,configurable:n.type_!==1||t!=="length",enumerable:i.enumerable,value:e[t]}},defineProperty(){z(11)},getPrototypeOf(n){return Kt(n.base_)},setPrototypeOf(){z(12)}},Qe={};Xe(Ti,(n,t)=>{Qe[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Qe.deleteProperty=function(n,t){return Qe.set.call(this,n,t,void 0)};Qe.set=function(n,t,e){return Ti.set.call(this,n[0],t,e,n[0])};function Yn(n,t){const e=n[it];return(e?Wt(e):n)[t]}function Uo(n,t,e){var r;const i=Cr(t,e);return i?"value"in i?i.value:(r=i.get)==null?void 0:r.call(n.draft_):void 0}function Cr(n,t){if(!(t in n))return;let e=Kt(n);for(;e;){const i=Object.getOwnPropertyDescriptor(e,t);if(i)return i;e=Kt(e)}}function hi(n){n.modified_||(n.modified_=!0,n.parent_&&hi(n.parent_))}function Xn(n){n.copy_||(n.copy_=ci(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var Ho=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,e,i)=>{if(typeof t=="function"&&typeof e!="function"){const s=e;e=t;const o=this;return function(c=s,...l){return o.produce(c,u=>e.call(this,u,...l))}}typeof e!="function"&&z(6),i!==void 0&&typeof i!="function"&&z(7);let r;if(Lt(t)){const s=hs(this),o=fi(t,void 0);let a=!0;try{r=e(o),a=!1}finally{a?li(s):di(s)}return ds(s,i),fs(r,s)}else if(!t||typeof t!="object"){if(r=e(t),r===void 0&&(r=t),r===xi&&(r=void 0),this.autoFreeze_&&Ai(r,!0),i){const s=[],o=[];Jt("Patches").generateReplacementPatches_(t,r,s,o),i(s,o)}return r}else z(1,t)},this.produceWithPatches=(t,e)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let i,r;return[this.produce(t,e,(o,a)=>{i=o,r=a}),i,r]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Lt(n)||z(8),Zt(n)&&(n=Go(n));const t=hs(this),e=fi(n,void 0);return e[it].isManual_=!0,di(t),e}finishDraft(n,t){const e=n&&n[it];(!e||!e.isManual_)&&z(9);const{scope_:i}=e;return ds(i,t),fs(void 0,i)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,t){let e;for(e=t.length-1;e>=0;e--){const r=t[e];if(r.path.length===0&&r.op==="replace"){n=r.value;break}}e>-1&&(t=t.slice(e+1));const i=Jt("Patches").applyPatches_;return Zt(n)?i(n,t):this.produce(n,r=>i(r,t))}};function fi(n,t){const e=rn(n)?Jt("MapSet").proxyMap_(n,t):on(n)?Jt("MapSet").proxySet_(n,t):ko(n,t);return(t?t.scope_:Mr()).drafts_.push(e),e}function Go(n){return Zt(n)||z(10,n),Sr(n)}function Sr(n){if(!Lt(n)||Nn(n))return n;const t=n[it];let e;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,e=ci(n,t.scope_.immer_.useStrictShallowCopy_)}else e=ci(n,!0);return Xe(e,(i,r)=>{Rr(e,i,Sr(r))}),t&&(t.finalized_=!1),e}function Oi(){const t="replace",e="add",i="remove";function r(_,m,p,f){switch(_.type_){case 0:case 2:return o(_,m,p,f);case 1:return s(_,m,p,f);case 3:return a(_,m,p,f)}}function s(_,m,p,f){let{base_:A,assigned_:C}=_,S=_.copy_;S.length<A.length&&([A,S]=[S,A],[p,f]=[f,p]);for(let R=0;R<A.length;R++)if(C[R]&&S[R]!==A[R]){const y=m.concat([R]);p.push({op:t,path:y,value:d(S[R])}),f.push({op:t,path:y,value:d(A[R])})}for(let R=A.length;R<S.length;R++){const y=m.concat([R]);p.push({op:e,path:y,value:d(S[R])})}for(let R=S.length-1;A.length<=R;--R){const y=m.concat([R]);f.push({op:i,path:y})}}function o(_,m,p,f){const{base_:A,copy_:C}=_;Xe(_.assigned_,(S,R)=>{const y=zn(A,S),g=zn(C,S),x=R?Ke(A,S)?t:e:i;if(y===g&&x===t)return;const T=m.concat(S);p.push(x===i?{op:x,path:T}:{op:x,path:T,value:g}),f.push(x===e?{op:i,path:T}:x===i?{op:e,path:T,value:d(y)}:{op:t,path:T,value:d(y)})})}function a(_,m,p,f){let{base_:A,copy_:C}=_,S=0;A.forEach(R=>{if(!C.has(R)){const y=m.concat([S]);p.push({op:i,path:y,value:R}),f.unshift({op:e,path:y,value:R})}S++}),S=0,C.forEach(R=>{if(!A.has(R)){const y=m.concat([S]);p.push({op:e,path:y,value:R}),f.unshift({op:i,path:y,value:R})}S++})}function c(_,m,p,f){p.push({op:t,path:[],value:m===xi?void 0:m}),f.push({op:t,path:[],value:_})}function l(_,m){return m.forEach(p=>{const{path:f,op:A}=p;let C=_;for(let g=0;g<f.length-1;g++){const x=Qt(C);let T=f[g];typeof T!="string"&&typeof T!="number"&&(T=""+T),(x===0||x===1)&&(T==="__proto__"||T==="constructor")&&z(19),typeof C=="function"&&T==="prototype"&&z(19),C=zn(C,T),typeof C!="object"&&z(18,f.join("/"))}const S=Qt(C),R=u(p.value),y=f[f.length-1];switch(A){case t:switch(S){case 2:return C.set(y,R);case 3:z(16);default:return C[y]=R}case e:switch(S){case 1:return y==="-"?C.push(R):C.splice(y,0,R);case 2:return C.set(y,R);case 3:return C.add(R);default:return C[y]=R}case i:switch(S){case 1:return C.splice(y,1);case 2:return C.delete(y);case 3:return C.delete(p.value);default:return delete C[y]}default:z(17,A)}}),_}function u(_){if(!Lt(_))return _;if(Array.isArray(_))return _.map(u);if(rn(_))return new Map(Array.from(_.entries()).map(([p,f])=>[p,u(f)]));if(on(_))return new Set(Array.from(_).map(u));const m=Object.create(Kt(_));for(const p in _)m[p]=u(_[p]);return Ke(_,je)&&(m[je]=_[je]),m}function d(_){return Zt(_)?u(_):_}Do("Patches",{applyPatches_:l,generatePatches_:r,generateReplacementPatches_:c})}var st=new Ho;st.produce;var vi=st.produceWithPatches.bind(st);st.setAutoFreeze.bind(st);st.setUseStrictShallowCopy.bind(st);st.applyPatches.bind(st);st.createDraft.bind(st);st.finishDraft.bind(st);var de=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};Oi();class Vo{constructor(t){this.messageBus=t}getItems(t){return de(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e){return de(this,void 0,void 0,function*(){let i;this.isItemArray(t)?i=t:i=yield this.getItems(t);const[r,s]=vi(i,e),o=r.map(c=>({id:c.id,type:c.type}));for(const c of s){const[l,u]=c.path;typeof l=="number"&&typeof u=="string"&&(o[l][u]=r[l][u])}const a=o.filter(c=>Object.keys(c).length>2);a.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:a}))})}addItems(t){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:t})})}deleteItems(t){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return de(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return de(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=i=>{t(i.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",e)}}}var he=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};Oi();class Fo{constructor(t){this.messageBus=t}getItems(t){return he(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e,i){return he(this,void 0,void 0,function*(){let r;this.isItemArray(t)?r=t:r=yield this.getItems(t);const[s,o]=vi(r,e),a=s.map(l=>({id:l.id,type:l.type}));for(const l of o){const[u,d]=l.path;typeof u=="number"&&typeof d=="string"&&(a[u][d]=s[u][d])}const c=a.filter(l=>Object.keys(l).length>2);c.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:c,fastUpdate:i}))})}addItems(t){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:t})})}deleteItems(t){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return he(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return he(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=i=>{t(i.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",e)}}}var Kn=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class Wo{constructor(t){this.messageBus=t,this.grid=new bo(t),this.fog=new wo(t),this.history=new Bo(t),this.items=new Vo(t),this.local=new Fo(t)}isReady(){return Kn(this,void 0,void 0,function*(){const{ready:t}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return t})}onReadyChange(t){const e=i=>{t(i.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",e)}}getMetadata(){return Kn(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return t})}setMetadata(t){return Kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:t})})}onMetadataChange(t){const e=i=>{t(i.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",e)}}}function wr(n){return n.startsWith("http")?n:`${window.location.origin}${n}`}function qe(n){return n.map(t=>Object.assign(Object.assign({},t),{icon:wr(t.icon)}))}function Ri(n){return Object.assign(Object.assign({},n),{url:wr(n.url)})}var ys=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class jo{constructor(t){this.contextMenus={},this.handleClick=e=>{var i;const r=this.contextMenus[e.id];r&&((i=r.onClick)===null||i===void 0||i.call(r,e.context,e.elementId))},this.messageBus=t,t.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(t){return ys(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:t.id,shortcut:t.shortcut,icons:qe(t.icons),embed:t.embed&&Ri(t.embed)}),this.contextMenus[t.id]=t})}remove(t){return ys(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:t}),delete this.contextMenus[t]})}}var ot=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class qo{constructor(t){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=e=>{const i=this.tools[e.id];if(i)if(i.onClick){const r=i.onClick(e.context,e.elementId);Promise.resolve(r).then(s=>{s&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})},this.handleToolActionClick=e=>{var i;const r=this.toolActions[e.id];r&&((i=r.onClick)===null||i===void 0||i.call(r,e.context,e.elementId))},this.handleToolModeClick=e=>{const i=this.toolModes[e.id];if(i)if(i.onClick){const r=i.onClick(e.context,e.elementId);Promise.resolve(r).then(s=>{s&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})},this.handleToolModeToolClick=e=>{const i=this.toolModes[e.id];if(i)if(i.onToolClick){const r=i.onToolClick(e.context,e.event);Promise.resolve(r).then(s=>{s&&e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDoubleClick=e=>{const i=this.toolModes[e.id];if(i)if(i.onToolDoubleClick){const r=i.onToolDoubleClick(e.context,e.event);Promise.resolve(r).then(s=>{s&&e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDown=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onToolDown)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeToolMove=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onToolMove)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeToolUp=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onToolUp)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeToolDragStart=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onToolDragStart)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeToolDragMove=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onToolDragMove)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeToolDragEnd=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onToolDragEnd)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeToolDragCancel=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onToolDragCancel)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeKeyDown=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onKeyDown)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeKeyUp=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onKeyUp)===null||i===void 0||i.call(r,e.context,e.event))},this.handleToolModeActivate=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onActivate)===null||i===void 0||i.call(r,e.context))},this.handleToolModeDeactivate=e=>{var i;const r=this.toolModes[e.id];r&&((i=r.onDeactivate)===null||i===void 0||i.call(r,e.context))},this.messageBus=t,t.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),t.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),t.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),t.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),t.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),t.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),t.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),t.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(t){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:t.id,shortcut:t.shortcut,defaultMode:t.defaultMode,defaultMetadata:t.defaultMetadata,icons:qe(t.icons),disabled:t.disabled}),this.tools[t.id]=t})}remove(t){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:t}),delete this.tools[t]})}activateTool(t){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:t})})}getActiveTool(){return ot(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_TOOL_GET_ACTIVE",{});return t})}onToolChange(t){const e=i=>{t(i.id)};return this.messageBus.send("OBR_TOOL_ACTIVE_SUBSCRIBE",{}),this.messageBus.on("OBR_TOOL_ACTIVE_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_TOOL_ACTIVE_UNSUBSCRIBE",{}),this.messageBus.off("OBR_TOOL_ACTIVE_EVENT_CHANGE",e)}}getMetadata(t){return ot(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:t});return e})}setMetadata(t,e){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:t,update:e})})}createAction(t){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:t.id,shortcut:t.shortcut,icons:qe(t.icons),disabled:t.disabled}),this.toolActions[t.id]=t})}removeAction(t){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:t}),delete this.tools[t]})}createMode(t){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:t.id,shortcut:t.shortcut,icons:qe(t.icons),preventDrag:t.preventDrag,disabled:t.disabled,cursors:t.cursors}),this.toolModes[t.id]=t})}removeMode(t){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:t}),delete this.tools[t]})}activateMode(t,e){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:t,modeId:e})})}getActiveToolMode(){return ot(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_TOOL_MODE_GET_ACTIVE",{});return t})}onToolModeChange(t){const e=i=>{t(i.id)};return this.messageBus.send("OBR_TOOL_MODE_ACTIVE_SUBSCRIBE",{}),this.messageBus.on("OBR_TOOL_MODE_ACTIVE_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_TOOL_MODE_ACTIVE_UNSUBSCRIBE",{}),this.messageBus.off("OBR_TOOL_MODE_ACTIVE_EVENT_CHANGE",e)}}}var fe=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class zo{constructor(t){this.messageBus=t}open(t){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},Ri(t)))})}close(t){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:t})})}getWidth(t){return fe(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:t});return e})}setWidth(t,e){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:t,width:e})})}getHeight(t){return fe(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:t});return e})}setHeight(t,e){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:t,height:e})})}}var ps=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class Yo{constructor(t){this.messageBus=t}open(t){return ps(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},Ri(t)))})}close(t){return ps(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:t})})}}var K=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class Xo{constructor(t){this.messageBus=t}getWidth(){return K(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return t})}setWidth(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:t})})}getHeight(){return K(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return t})}setHeight(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:t})})}getBadgeText(){return K(this,void 0,void 0,function*(){const{badgeText:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return t})}setBadgeText(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:t})})}getBadgeBackgroundColor(){return K(this,void 0,void 0,function*(){const{badgeBackgroundColor:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return t})}setBadgeBackgroundColor(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:t})})}getIcon(){return K(this,void 0,void 0,function*(){const{icon:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return t})}setIcon(t){return K(this,void 0,void 0,function*(){const e=qe([{icon:t}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:e[0].icon})})}getTitle(){return K(this,void 0,void 0,function*(){const{title:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return t})}setTitle(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:t})})}isOpen(){return K(this,void 0,void 0,function*(){const{isOpen:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return t})}open(){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(t){const e=i=>{t(i.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e)}}}var Ko=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};Oi();class Zo{constructor(t){this.messageBus=t}startItemInteraction(t){return Ko(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:t});let i=t;return[o=>{const[a,c]=vi(i,o);return i=a,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:e,patches:c}),a},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:e})}]})}}var Qo=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class Jo{constructor(t){this.messageBus=t}getPlayers(){return Qo(this,void 0,void 0,function*(){const{players:t}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return t})}onChange(t){const e=i=>{t(i.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",e)}}}var Zn=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class ta{constructor(t){this.messageBus=t}get id(){return this.messageBus.roomId}getPermissions(){return Zn(this,void 0,void 0,function*(){const{permissions:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return t})}getMetadata(){return Zn(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return t})}setMetadata(t){return Zn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:t})})}onMetadataChange(t){const e=i=>{t(i.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",e)}}onPermissionsChange(t){const e=i=>{t(i.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e)}}}var ea=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class na{constructor(t){this.messageBus=t}getTheme(){return ea(this,void 0,void 0,function*(){const{theme:t}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return t})}onChange(t){const e=i=>{t(i.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",e)}}}var xn=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class ia{constructor(t){this.messageBus=t}uploadImages(t,e){return xn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:t,typeHint:e})})}uploadScenes(t,e){return xn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:t,disableShowScenes:e})})}downloadImages(t,e,i){return xn(this,void 0,void 0,function*(){const{images:r}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:t,defaultSearch:e,typeHint:i},-1);return r})}downloadScenes(t,e){return xn(this,void 0,void 0,function*(){const{scenes:i}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:t,defaultSearch:e},-1);return i})}}var sa=function(n,t,e,i){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})};class ra{constructor(t){this.messageBus=t}sendMessage(t,e,i){return sa(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:t,data:e,options:i})})}onMessage(t,e){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:t}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${t}`,e),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:t}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${t}`,e)}}}class rt{constructor(t){this._item={createdUserId:t.id,id:Or(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:t.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(t){return this._item.createdUserId=t,this.self()}id(t){return this._item.id=t,this.self()}name(t){return this._item.name=t,this.self()}description(t){return this._item.description=t,this.self()}lastModified(t){return this._item.lastModified=t,this.self()}zIndex(t){return this._item.zIndex=t,this.self()}lastModifiedUserId(t){return this._item.lastModifiedUserId=t,this.self()}locked(t){return this._item.locked=t,this.self()}metadata(t){return this._item.metadata=t,this.self()}position(t){return this._item.position=t,this.self()}rotation(t){return this._item.rotation=t,this.self()}scale(t){return this._item.scale=t,this.self()}visible(t){return this._item.visible=t,this.self()}attachedTo(t){return this._item.attachedTo=t,this.self()}layer(t){return this._item.layer=t,this.self()}disableHit(t){return this._item.disableHit=t,this.self()}disableAutoZIndex(t){return this._item.disableAutoZIndex=t,this.self()}disableAttachmentBehavior(t){return this._item.disableAttachmentBehavior=t,this.self()}self(){return this}}class oa extends rt{constructor(t){super(t),this._points=[],this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[],tension:.5},this._item.name="Curve",this._item.layer="DRAWING"}points(t){return this._points=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}tension(t){return this._style.tension=t,this.self()}closed(t){return this._style.closed=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"CURVE",points:this._points,style:this._style})}}class aa extends rt{constructor(t,e,i){super(t),this._image=e,this._grid=i,this._item.name="Image",this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:24,fontWeight:400,textAlign:"CENTER",textAlignVertical:"BOTTOM",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._textItemType="LABEL"}text(t){return this._text=t,this.self()}textItemType(t){return this._textItemType=t,this.self()}textWidth(t){return this._text.width=t,this.self()}textHeight(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}textPadding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}textFillColor(t){return this._text.style.fillColor=t,this.self()}textFillOpacity(t){return this._text.style.fillOpacity=t,this.self()}textStrokeColor(t){return this._text.style.strokeColor=t,this.self()}textStrokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}textStrokeWidth(t){return this._text.style.strokeWidth=t,this.self()}textLineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"IMAGE",image:this._image,grid:this._grid,text:this._text,textItemType:this._textItemType})}}class ca extends rt{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"CENTER",textAlignVertical:"MIDDLE",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._style={backgroundColor:"#3D4051",backgroundOpacity:1,cornerRadius:8,pointerDirection:"DOWN",pointerWidth:4,pointerHeight:4},this._item.layer="TEXT",this._item.name="Label"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}style(t){return this._style=t,this.self()}backgroundColor(t){return this._style.backgroundColor=t,this.self()}backgroundOpacity(t){return this._style.backgroundOpacity=t,this.self()}cornerRadius(t){return this._style.cornerRadius=t,this.self()}pointerWidth(t){return this._style.pointerWidth=t,this.self()}pointerHeight(t){return this._style.pointerHeight=t,this.self()}pointerDirection(t){return this._style.pointerDirection=t,this.self()}maxViewScale(t){return this._style.maxViewScale=t,this.self()}minViewScale(t){return this._style.minViewScale=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LABEL",text:this._text,style:this._style})}}class ua extends rt{constructor(t){super(t),this._style={strokeColor:"black",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._startPosition={x:0,y:0},this._endPosition={x:0,y:0},this._item.layer="DRAWING",this._item.name="Line"}style(t){return this._style=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}startPosition(t){return this._startPosition=t,this.self()}endPosition(t){return this._endPosition=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LINE",startPosition:this._startPosition,endPosition:this._endPosition,style:this._style})}}class la extends rt{constructor(t){super(t),this._color="black",this._radius=20,this._item.layer="POINTER",this._item.name="Pointer"}color(t){return this._color=t,this.self()}radius(t){return this._radius=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"POINTER",color:this._color,radius:this._radius})}}class da extends rt{constructor(t){super(t),this._startPosition={x:0,y:0},this._endPosition={x:0,y:0},this._measurement="",this._item.layer="RULER",this._item.name="Ruler",this._style={variant:"FILLED"}}startPosition(t){return this._startPosition=t,this.self()}endPosition(t){return this._endPosition=t,this.self()}measurement(t){return this._measurement=t,this.self()}variant(t){return this._style.variant=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"RULER",startPosition:this._startPosition,endPosition:this._endPosition,measurement:this._measurement,style:this._style})}}class ha extends rt{constructor(t){super(t),this._width=0,this._height=0,this._shapeType="RECTANGLE",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.layer="DRAWING",this._item.name="Shape"}width(t){return this._width=t,this.self()}height(t){return this._height=t,this.self()}shapeType(t){return this._shapeType=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"SHAPE",width:this._width,height:this._height,shapeType:this._shapeType,style:this._style})}}class fa extends rt{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}class _a extends rt{constructor(t){super(t),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(t){return this._commands=t,this.self()}fillRule(t){return this._fillRule=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}class ya{constructor(t){this._upload={file:t,grid:{dpi:150,offset:{x:0,y:0}},name:"",rotation:0,scale:{x:1,y:1},text:{richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:24,fontWeight:400,textAlign:"CENTER",textAlignVertical:"BOTTOM",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},locked:!1,textItemType:"LABEL",visible:!0}}grid(t){return this._upload.grid=t,this}dpi(t){return this._upload.grid.dpi=t,this}offset(t){return this._upload.grid.offset=t,this}name(t){return this._upload.name=t,this}description(t){return this._upload.description=t,this}rotation(t){return this._upload.rotation=t,this}scale(t){return this._upload.scale=t,this}locked(t){return this._upload.locked=t,this}visible(t){return this._upload.visible=t,this}text(t){return this._upload.text=t,this}textItemType(t){return this._upload.textItemType=t,this}textWidth(t){return this._upload.text.width=t,this}textHeight(t){return this._upload.text.height=t,this}richText(t){return this._upload.text.richText=t,this}plainText(t){return this._upload.text.plainText=t,this}textType(t){return this._upload.text.type=t,this}textPadding(t){return this._upload.text.style.padding=t,this}fontFamily(t){return this._upload.text.style.fontFamily=t,this}fontSize(t){return this._upload.text.style.fontSize=t,this}fontWeight(t){return this._upload.text.style.fontWeight=t,this}textAlign(t){return this._upload.text.style.textAlign=t,this}textAlignVertical(t){return this._upload.text.style.textAlignVertical=t,this}textFillColor(t){return this._upload.text.style.fillColor=t,this}textFillOpacity(t){return this._upload.text.style.fillOpacity=t,this}textStrokeColor(t){return this._upload.text.style.strokeColor=t,this}textStrokeOpacity(t){return this._upload.text.style.strokeOpacity=t,this}textStrokeWidth(t){return this._upload.text.style.strokeWidth=t,this}textLineHeight(t){return this._upload.text.style.lineHeight=t,this}build(){return this._upload}}class pa{constructor(){this._upload={name:"New Scene",fog:{filled:!1,style:{color:"#222222",strokeWidth:5}},grid:{dpi:150,scale:"5ft",style:{lineColor:"LIGHT",lineOpacity:.4,lineType:"DASHED",lineWidth:2},measurement:"CHEBYSHEV",type:"SQUARE"},items:[]}}name(t){return this._upload.name=t,this}fogFilled(t){return this._upload.fog.filled=t,this}fogColor(t){return this._upload.fog.style.color=t,this}fogStrokeWidth(t){return this._upload.fog.style.strokeWidth=t,this}gridScale(t){return this._upload.grid.scale=t,this}gridColor(t){return this._upload.grid.style.lineColor=t,this}gridOpacity(t){return this._upload.grid.style.lineOpacity=t,this}gridLineType(t){return this._upload.grid.style.lineType=t,this}gridMeasurement(t){return this._upload.grid.measurement=t,this}gridType(t){return this._upload.grid.type=t,this}items(t){return this._upload.items=t,this}baseMap(t){return this._upload.baseMap=t,this}thumbnail(t){return this._upload.thumbnail=t,this}build(){return this._upload}}const Mi=typeof Buffer=="function",ms=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const ma="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ga=Array.prototype.slice.call(ma),An=(n=>{let t={};return n.forEach((e,i)=>t[e]=i),t})(ga),Ea=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,zt=String.fromCharCode.bind(String),gs=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),br=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),xa=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Aa=n=>{switch(n.length){case 4:var t=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),e=t-65536;return zt((e>>>10)+55296)+zt((e&1023)+56320);case 3:return zt((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return zt((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},Ta=n=>n.replace(xa,Aa),Oa=n=>{if(n=n.replace(/\s+/g,""),!Ea.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let t,e="",i,r;for(let s=0;s<n.length;)t=An[n.charAt(s++)]<<18|An[n.charAt(s++)]<<12|(i=An[n.charAt(s++)])<<6|(r=An[n.charAt(s++)]),e+=i===64?zt(t>>16&255):r===64?zt(t>>16&255,t>>8&255):zt(t>>16&255,t>>8&255,t&255);return e},Br=typeof atob=="function"?n=>atob(br(n)):Mi?n=>Buffer.from(n,"base64").toString("binary"):Oa,va=Mi?n=>gs(Buffer.from(n,"base64")):n=>gs(Br(n).split("").map(t=>t.charCodeAt(0))),Ra=Mi?n=>Buffer.from(n,"base64").toString("utf8"):ms?n=>ms.decode(va(n)):n=>Ta(Br(n)),Ma=n=>br(n.replace(/[-_]/g,t=>t=="-"?"+":"/")),Ca=n=>Ra(Ma(n));function Sa(){const t=new URLSearchParams(window.location.search).get("obrref");let e="",i="";if(t){const s=Ca(t).split(" ");s.length===2&&(e=s[0],i=s[1])}return{origin:e,roomId:i}}class wa extends rt{constructor(t,e,i){super(t),this._image=e,this._grid=i,this._item.name="Billboard",this._style={}}maxViewScale(t){return this._style.maxViewScale=t,this.self()}minViewScale(t){return this._style.minViewScale=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"BILLBOARD",image:this._image,grid:this._grid,style:this._style})}}class ba extends rt{constructor(t){super(t),this._item.name="Effect",this._width=0,this._height=0,this._sksl="",this._effectType="VIEWPORT",this._uniforms=[],this._blendMode="SRC_OVER"}width(t){return this._width=t,this.self()}height(t){return this._height=t,this.self()}sksl(t){return this._sksl=t,this.self()}effectType(t){return this._effectType=t,this.self()}uniforms(t){return this._uniforms=t,this.self()}blendMode(t){return this._blendMode=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"EFFECT",width:this._width,height:this._height,sksl:this._sksl,effectType:this._effectType,uniforms:this._uniforms,blendMode:this._blendMode})}}class Ba extends rt{constructor(t){super(t),this._sourceRadius=50,this._attenuationRadius=12*150,this._falloff=1,this._innerAngle=360,this._outerAngle=360,this._lightType="PRIMARY",this._item.name="Light",this._item.layer="FOG",this._item.zIndex=0,this._item.disableAutoZIndex=!0}sourceRadius(t){return this._sourceRadius=t,this.self()}attenuationRadius(t){return this._attenuationRadius=t,this.self()}falloff(t){return this._falloff=t,this.self()}innerAngle(t){return this._innerAngle=t,this.self()}outerAngle(t){return this._outerAngle=t,this.self()}lightType(t){return this._lightType=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LIGHT",sourceRadius:this._sourceRadius,attenuationRadius:this._attenuationRadius,falloff:this._falloff,innerAngle:this._innerAngle,outerAngle:this._outerAngle,lightType:this._lightType})}}class Ia extends rt{constructor(t){super(t),this._points=[],this._doubleSided=!0,this._blocking=!0,this._item.name="Wall",this._item.layer="FOG",this._item.zIndex=0,this._item.disableAutoZIndex=!0}points(t){return this._points=t,this.self()}doubleSided(t){return this._doubleSided=t,this.self()}blocking(t){return this._blocking=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"WALL",points:this._points,doubleSided:this._doubleSided,blocking:this._blocking})}}function Na(n){return n.type==="BILLBOARD"}function Pa(n){return n.type==="CURVE"}function Da(n){return n.type==="EFFECT"}function La(n){return n.type==="IMAGE"}function $a(n){return n.type==="LABEL"}function ka(n){return n.type==="LIGHT"}function Ua(n){return n.type==="LINE"}var Q;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})(Q||(Q={}));function Ha(n){return n.type==="PATH"}function Ga(n){return n.type==="POINTER"}function Va(n){return n.type==="RULER"}function Fa(n){return n.type==="SHAPE"}function Wa(n){return n.type==="TEXT"}function ja(n){return"text"in n}function qa(n){return"children"in n}function za(n){return n.type==="WALL"}function Es(n,t){return Math.round(n/t)*t}function xs(n,t){return Math.floor(n/t)*t}function _i(n){return n*(Math.PI/180)}function Ya(n){return n*(180/Math.PI)}function As(n,t,e){return n*(1-e)+t*e}class Xa{static magnitudeSquared(t){return t.x*t.x+t.y*t.y}static magnitude(t){const e=Math.sqrt(this.magnitudeSquared(t));return isNaN(e)?0:e}static normalize(t){const e=this.magnitude(t);return e===0?{x:0,y:0}:this.divide(t,e)}static dot(t,e){return t.x*e.x+t.y*e.y}static subtract(t,e){return typeof e=="number"?{x:t.x-e,y:t.y-e}:{x:t.x-e.x,y:t.y-e.y}}static add(t,e){return typeof e=="number"?{x:t.x+e,y:t.y+e}:{x:t.x+e.x,y:t.y+e.y}}static multiply(t,e){return typeof e=="number"?{x:t.x*e,y:t.y*e}:{x:t.x*e.x,y:t.y*e.y}}static divide(t,e){return typeof e=="number"?{x:t.x/e,y:t.y/e}:{x:t.x/e.x,y:t.y/e.y}}static rotate(t,e,i){const r=Math.cos(_i(i)),s=Math.sin(_i(i)),o=this.subtract(t,e);return{x:e.x+r*o.x-s*o.y,y:e.y+s*o.x+r*o.y}}static min(t,e){return typeof e=="number"?{x:Math.min(t.x,e),y:Math.min(t.y,e)}:{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y)}}static componentMin(t){return t.x<t.y?t.x:t.y}static max(t,e){return typeof e=="number"?{x:Math.max(t.x,e),y:Math.max(t.y,e)}:{x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)}}static componentMax(t){return t.x>t.y?t.x:t.y}static roundTo(t,e){return{x:Es(t.x,e.x),y:Es(t.y,e.y)}}static floorTo(t,e){return{x:xs(t.x,e.x),y:xs(t.y,e.y)}}static sign(t){return{x:Math.sign(t.x),y:Math.sign(t.y)}}static abs(t){return{x:Math.abs(t.x),y:Math.abs(t.y)}}static pow(t,e){return typeof e=="number"?{x:Math.pow(t.x,e),y:Math.pow(t.y,e)}:{x:Math.pow(t.x,e.x),y:Math.pow(t.y,e.y)}}static clamp(t,e,i){return{x:Math.min(Math.max(t.x,e),i),y:Math.min(Math.max(t.y,e),i)}}static boundingBox(t){let e=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(let l of t)e=l.x<e?l.x:e,i=l.x>i?l.x:i,r=l.y<r?l.y:r,s=l.y>s?l.y:s;let o=i-e,a=s-r,c={x:(e+i)/2,y:(r+s)/2};return{min:{x:e,y:r},max:{x:i,y:s},width:o,height:a,center:c}}static pointInPolygon(t,e){const i=this.boundingBox(e);if(t.x<i.min.x||t.x>i.max.x||t.y<i.min.y||t.y>i.max.y)return!1;let r=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].y>t.y,c=e[o].y>t.y;a!==c&&t.x<(e[o].x-e[s].x)*(t.y-e[s].y)/(e[o].y-e[s].y)+e[s].x&&(r=!r)}return r}static compare(t,e,i){return this.magnitudeSquared(this.subtract(t,e))<i*i}static distance(t,e){return this.magnitude(this.subtract(t,e))}static lerp(t,e,i){return{x:As(t.x,e.x,i),y:As(t.y,e.y,i)}}static centroid(t){let e={x:0,y:0};for(let i of t)e.x+=i.x,e.y+=i.y;return t.length>0&&(e={x:e.x/t.length,y:e.y/t.length}),e}}class qt{static inverse(t){const[e,i,r,s,o,a,c,l,u]=t,d=e*(o*u-l*a)-i*(s*u-a*c)+r*(s*l-o*c);if(Math.abs(d)<1e-14)return t;const _=1/d,m=(o*u-l*a)*_,p=(r*l-i*u)*_,f=(i*a-r*o)*_,A=(a*c-s*u)*_,C=(e*u-r*c)*_,S=(s*r-e*a)*_,R=(s*l-c*o)*_,y=(c*i-e*l)*_,g=(e*o-s*i)*_;return[m,p,f,A,C,S,R,y,g]}static multiply(t,e){return[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}static fromPosition(t){return[1,0,t.x,0,1,t.y,0,0,1]}static fromRotation(t){const e=_i(t);return[Math.cos(e),-Math.sin(e),0,Math.sin(e),Math.cos(e),0,0,0,1]}static fromScale(t){return[t.x,0,0,0,t.y,0,0,0,1]}static fromItem(t){const e=qt.fromPosition(t.position),i=qt.fromScale(t.scale),r=qt.fromRotation(t.rotation);return qt.multiply(qt.multiply(e,r),i)}static decompose(t){const[e,i,r,s,o,a]=t,c=e*o-s*i,l={position:{x:r,y:a},rotation:0,scale:{x:1,y:1}};if(e!=0||s!=0){var u=Math.sqrt(e*e+s*s);l.rotation=s>0?Math.acos(e/u):-Math.acos(e/u),l.scale={x:u,y:c/u}}else if(i!=0||o!=0){var d=Math.sqrt(i*i+o*o);l.rotation=Math.PI/2-(o>0?Math.acos(-i/d):-Math.acos(i/d)),l.scale={x:c/d,y:d}}return l.rotation=Ya(l.rotation),l}}const yi=Sa(),G=new Co(yi.origin,yi.roomId),Ka=new Eo(G),nt=new go(G),Za=new Jo(G),Qa=new So(G),Ja=new Wo(G),tc=new jo(G),ec=new qo(G),nc=new zo(G),ic=new Yo(G),sc=new Xo(G),rc=new Zo(G),oc=new ta(G),ac=new na(G),cc=new ia(G),uc=new ra(G),L={onReady:n=>{G.ready?n():G.once("OBR_READY",()=>n())},get isReady(){return G.ready},viewport:Ka,player:nt,party:Za,notification:Qa,scene:Ja,contextMenu:tc,tool:ec,popover:nc,modal:ic,action:sc,interaction:rc,room:oc,theme:ac,assets:cc,broadcast:uc,isAvailable:!!yi.origin};function lc(n,t){return new wa(nt,n,t)}function dc(){return new oa(nt)}function hc(){return new ba(nt)}function fc(n,t){return new aa(nt,n,t)}function Ir(){return new ca(nt)}function _c(){return new Ba(nt)}function yc(){return new ua(nt)}function pc(){return new la(nt)}function mc(){return new da(nt)}function gc(){return new ha(nt)}function Ec(){return new fa(nt)}function pi(){return new _a(nt)}function xc(){return new Ia(nt)}function Ac(n){return new ya(n)}function Tc(){return new pa}const Oc=Object.freeze(Object.defineProperty({__proto__:null,get Command(){return Q},Math2:Xa,MathM:qt,buildBillboard:lc,buildCurve:dc,buildEffect:hc,buildImage:fc,buildImageUpload:Ac,buildLabel:Ir,buildLight:_c,buildLine:yc,buildPath:pi,buildPointer:pc,buildRuler:mc,buildSceneUpload:Tc,buildShape:gc,buildText:Ec,buildWall:xc,default:L,isBillboard:Na,isCurve:Pa,isEffect:Da,isElement:qa,isFormattedText:ja,isImage:La,isLabel:$a,isLight:ka,isLine:Ua,isPath:Ha,isPointer:Ga,isRuler:Va,isShape:Fa,isText:Wa,isWall:za},Symbol.toStringTag,{value:"Module"})),yt=mo(Oc);var Ot={},ve={},Ts;function Nr(){if(Ts)return ve;Ts=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.SnapTo=void 0;var n;return function(t){t[t.CORNER=1]="CORNER",t[t.CENTER=2]="CENTER",t[t.EDGE=4]="EDGE",t[t.CORNER_AND_CENTER=3]="CORNER_AND_CENTER",t[t.CORNER_AND_EDGE=5]="CORNER_AND_EDGE",t[t.CENTER_AND_EDGE=6]="CENTER_AND_EDGE",t[t.CORNER_AND_CENTER_AND_EDGE=7]="CORNER_AND_CENTER_AND_EDGE",t[t.ALL=-1]="ALL"}(n||(ve.SnapTo=n={})),ve}var Re={},Me={},Ce={},Os;function Et(){if(Os)return Ce;Os=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.Point=void 0;function n(e){return Math.abs(e)<1e-9?0:e}let t=class dt{constructor(...i){if(i.length===1&&typeof i[0]=="object")this.x=n(i[0].x),this.y=n(i[0].y);else if(i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number")this.x=n(i[0]),this.y=n(i[1]);else throw new Error("Invalid arguments to Point constructor")}static nearestPoint(i,r){if(r.length===0)throw new Error("Cannot find nearest point of empty array");const s=new dt(i);let o=r[0],a=s.distanceTo(o);for(let c=1;c<r.length;c++){const l=s.distanceTo(r[c]);l<a&&(o=r[c],a=l)}return new dt(o)}sub(i){return new dt({x:this.x-i.x,y:this.y-i.y})}add(i){return new dt({x:this.x+i.x,y:this.y+i.y})}scale(i){return new dt({x:this.x*i,y:this.y*i})}mult(i){return new dt({x:this.x*i,y:this.y*i})}div(i){return new dt({x:this.x/i,y:this.y/i})}roundToNearest(i){const r=typeof i=="number"?{x:i,y:i}:i;return new dt({x:Math.round(this.x/r.x)*r.x,y:Math.round(this.y/r.y)*r.y})}roundUpToNearest(i){return new dt({x:Math.ceil(this.x/i)*i,y:Math.ceil(this.y/i)*i})}roundDownToNearest(i){return new dt({x:Math.floor(this.x/i)*i,y:Math.floor(this.y/i)*i})}distanceTo(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))}equals(i){return Math.abs(this.x-i.x)<1&&Math.abs(this.y-i.y)<1}toString(){return`(${this.x.toFixed(0)}, ${this.y.toFixed(0)})`}};return Ce.Point=t,Ce}var vs;function Pr(){if(vs)return Me;vs=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.LineSegment=void 0;const n=Et();let t=class{constructor(i,r){if(i.x===r.x&&i.y===r.y)throw new Error("Cannot create a line with two identical points");i.x<r.x||i.x===r.x&&i.y<r.y?(this.p1=new n.Point(i),this.p2=new n.Point(r)):(this.p1=new n.Point(r),this.p2=new n.Point(i))}toString(i=0){const r=s=>s.toFixed(i).replace(/\.0+$/,"");return`Line(${r(this.p1.x)},${r(this.p1.y)} -> ${r(this.p2.x)},${r(this.p2.y)})`}equals(i){return this.p1.equals(i.p1)&&this.p2.equals(i.p2)}get length(){return this.p1.distanceTo(this.p2)}};return Me.LineSegment=t,Me}var Rs;function an(){if(Rs)return Re;Rs=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.Cell=void 0;const n=Pr();let t=class{get edges(){const i=[],r=this.corners;for(let s=0;s<r.length;s++){const o=r[s],a=r[(s+1)%r.length];i.push(new n.LineSegment(o,a))}return i}isAdjacent(i){return this.edges.some(r=>i.edges.some(s=>r.equals(s)))}};return Re.Cell=t,Re}var Se={},Ms;function Dr(){if(Ms)return Se;Ms=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.Square=void 0;const n=an(),t=Et(),e=bt();let i=class Mn extends n.Cell{constructor(s){super(),this.center=new t.Point(s)}static fromCoords(s){const o={x:e.grid.dpi/2,y:e.grid.dpi/2};return new Mn(new t.Point(s).add(o).roundToNearest(e.grid.dpi).sub(o))}get corners(){const s=e.grid.dpi/2;return[this.center.add({x:-s,y:-s}),this.center.add({x:+s,y:-s}),this.center.add({x:+s,y:+s}),this.center.add({x:-s,y:+s})]}toString(){return`Square${this.center}`}nearestPointOnEdge(s){const o=this.center.x-e.grid.dpi/2,a=this.center.x+e.grid.dpi/2,c=this.center.y-e.grid.dpi/2,l=this.center.y+e.grid.dpi/2,u=[{x:o,y:s.y},{x:a,y:s.y},{x:s.x,y:c},{x:s.x,y:l}];return t.Point.nearestPoint(s,u)}isAdjacent(s){const o=Math.abs(this.center.x-s.center.x),a=Math.abs(this.center.y-s.center.y);return o===e.grid.dpi&&a===0||o===0&&a===e.grid.dpi}static iterateCellsBoundingPoints(s){const o=Math.min(...s.map(d=>d.center.x)),a=Math.max(...s.map(d=>d.center.x)),c=Math.min(...s.map(d=>d.center.y)),l=Math.max(...s.map(d=>d.center.y)),u=[];for(let d=Math.floor(o);d<=Math.ceil(a);d+=e.grid.dpi)for(let _=Math.floor(c);_<=Math.ceil(l);_+=e.grid.dpi)u.push(Mn.fromCoords({x:d,y:_}));return u}containsPoint(s){return s.x>=this.center.x-e.grid.dpi/2&&s.x<this.center.x+e.grid.dpi/2&&s.y>=this.center.y-e.grid.dpi/2&&s.y<this.center.y+e.grid.dpi/2}neighbors(s){const o=[];for(let a=-e.grid.dpi;a<=e.grid.dpi;a+=e.grid.dpi)for(let c=-e.grid.dpi;c<=e.grid.dpi;c+=e.grid.dpi)a===0&&c===0||!s&&Math.abs(a)===Math.abs(c)||o.push(Mn.fromCoords(this.center.add({x:a,y:c})));return o}};return Se.Square=i,Se}var we={},Bt={},Cs;function Ci(){if(Cs)return Bt;Cs=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.xy_to_axial_v=e,Bt.xy_to_axial_h=i,Bt.axial_round=r,Bt.axial_to_xy_v=s,Bt.axial_to_xy_h=o;const n=bt(),t=Math.sqrt(3);function e(a,c){const l=(t/3*a-.3333333333333333*c)/n.grid.hexRadius,u=2/3*c/n.grid.hexRadius;return[l,u]}function i(a,c){const l=.6666666666666666*a/n.grid.hexRadius,u=(-1/3*a+t/3*c)/n.grid.hexRadius;return[l,u]}function r(a,c){const l=Math.round(a),u=Math.round(c);a-=l,c-=u;const d=Math.round(a+.5*c)*+(a*a>=c*c),_=Math.round(c+.5*a)*+(a*a<c*c);return[l+d,u+_]}function s(a,c){const l=n.grid.hexRadius*(t*a+t/2*c),u=n.grid.hexRadius*(3/2*c);return[l,u]}function o(a,c){const l=n.grid.hexRadius*(1.5*a),u=n.grid.hexRadius*(t/2*a+t*c);return[l,u]}return Bt}var be={},Ss;function Si(){if(Ss)return be;Ss=1,Object.defineProperty(be,"__esModule",{value:!0}),be.BaseHex=void 0;const n=an(),t=Et();let e=class extends n.Cell{constructor(r){super(),this.center=new t.Point(r)}nearestPointOnEdge(r){const s=t.Point.nearestPoint(r,this.corners),o=t.Point.nearestPoint(r,this.corners.filter(f=>f.distanceTo(s)>5)),a=s.x,c=s.y,l=o.x,u=o.y,d=r.x,_=r.y,m=this.center.x,p=this.center.y;return new t.Point({x:((a*u-c*l)*(d-m)-(a-l)*(d*p-_*m))/((a-l)*(_-p)-(c-u)*(d-m)),y:((a*u-c*l)*(_-p)-(c-u)*(d*p-_*m))/((a-l)*(_-p)-(c-u)*(d-m))})}};return be.BaseHex=e,be}var ws;function Lr(){if(ws)return we;ws=1,Object.defineProperty(we,"__esModule",{value:!0}),we.VHex=void 0;const n=Et(),t=bt(),e=Ci(),i=Si();let r=class ht extends i.BaseHex{static fromCoords(o){const a=new n.Point({x:o.x,y:o.y+t.grid.hexRadius/2}),[c,l]=(0,e.xy_to_axial_v)(a.x,a.y),[u,d]=(0,e.axial_round)(c,l),[_,m]=(0,e.axial_to_xy_v)(u,d);return new ht({x:_,y:m-t.grid.hexRadius/2})}static fromAxial(o,a){const[c,l]=(0,e.axial_round)(o,a),[u,d]=(0,e.axial_to_xy_v)(c,l);return new ht({x:u,y:d-t.grid.hexRadius/2})}get axialCoords(){const[o,a]=(0,e.xy_to_axial_v)(this.center.x,this.center.y);return[o,a,-o-a]}get corners(){return[this.center.add({x:0,y:-t.grid.hexRadius}),this.center.add({x:t.grid.dpi/2,y:-t.grid.hexRadius/2}),this.center.add({x:t.grid.dpi/2,y:t.grid.hexRadius/2}),this.center.add({x:0,y:t.grid.hexRadius}),this.center.add({x:-t.grid.dpi/2,y:t.grid.hexRadius/2}),this.center.add({x:-t.grid.dpi/2,y:-t.grid.hexRadius/2})]}toString(){return`VHex${this.center}`}isAdjacent(o){const a=Math.abs(this.center.x-o.center.x),c=Math.abs(this.center.y-o.center.y);return Math.abs(a-t.grid.dpi*.5)<1&&Math.abs(c-t.grid.hexRadius*1.5)<1||Math.abs(a-t.grid.dpi)<1&&c<1}static iterateCellsBoundingPoints(o){let a=1/0,c=-1/0,l=1/0,u=-1/0;for(const _ of o){const[m,p]=(0,e.xy_to_axial_v)(_.center.x,_.center.y);a=Math.min(a,p),c=Math.max(c,p),l=Math.min(l,m),u=Math.max(u,m)}const d=[];for(let _=Math.floor(a);_<=Math.ceil(c);_++)for(let m=Math.floor(l);m<=Math.ceil(u);m++){const[p,f]=(0,e.axial_to_xy_v)(m,_);d.push(ht.fromCoords({x:p,y:f}))}return d}containsPoint(o){const a=ht.fromCoords(o);return this.center.equals(a.center)}neighbors(o){const[a,c]=(0,e.xy_to_axial_v)(this.center.x,this.center.y);return[new ht(new n.Point(...(0,e.axial_to_xy_v)(a+1,c))),new ht(new n.Point(...(0,e.axial_to_xy_v)(a-1,c))),new ht(new n.Point(...(0,e.axial_to_xy_v)(a,c+1))),new ht(new n.Point(...(0,e.axial_to_xy_v)(a,c-1))),new ht(new n.Point(...(0,e.axial_to_xy_v)(a+1,c-1))),new ht(new n.Point(...(0,e.axial_to_xy_v)(a-1,c+1)))]}};return we.VHex=r,we}var Be={},bs;function $r(){if(bs)return Be;bs=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.HHex=void 0;const n=Et(),t=bt(),e=Ci(),i=Si();let r=class ft extends i.BaseHex{static fromCoords(o){const a=new n.Point({x:o.x+t.grid.hexRadius/2,y:o.y}),[c,l]=(0,e.xy_to_axial_h)(a.x,a.y),[u,d]=(0,e.axial_round)(c,l),[_,m]=(0,e.axial_to_xy_h)(u,d);return new ft({x:_-t.grid.hexRadius/2,y:m})}static fromAxial(o,a){const[c,l]=(0,e.axial_round)(o,a),[u,d]=(0,e.axial_to_xy_h)(c,l);return new ft({x:u-t.grid.hexRadius/2,y:d})}get axialCoords(){const[o,a]=(0,e.xy_to_axial_h)(this.center.x,this.center.y);return[o,a,-o-a]}get corners(){return[this.center.add({x:-t.grid.hexRadius,y:0}),this.center.add({x:-t.grid.hexRadius/2,y:t.grid.dpi/2}),this.center.add({x:t.grid.hexRadius/2,y:t.grid.dpi/2}),this.center.add({x:t.grid.hexRadius,y:0}),this.center.add({x:t.grid.hexRadius/2,y:-t.grid.dpi/2}),this.center.add({x:-t.grid.hexRadius/2,y:-t.grid.dpi/2})]}toString(){return`HHex${this.center}`}isAdjacent(o){const a=Math.abs(this.center.x-o.center.x),c=Math.abs(this.center.y-o.center.y);return Math.abs(a-t.grid.hexRadius*1.5)<1&&Math.abs(c-t.grid.dpi*.5)<1||a<1&&Math.abs(c-t.grid.dpi)<1}static iterateCellsBoundingPoints(o){let a=1/0,c=-1/0,l=1/0,u=-1/0;for(const _ of o){const[m,p]=(0,e.xy_to_axial_h)(_.center.x,_.center.y);a=Math.min(a,p),c=Math.max(c,p),l=Math.min(l,m),u=Math.max(u,m)}const d=[];for(let _=Math.floor(a);_<=Math.ceil(c);_++)for(let m=Math.floor(l);m<=Math.ceil(u);m++){const[p,f]=(0,e.axial_to_xy_h)(m,_);d.push(ft.fromCoords({x:p,y:f}))}return d}containsPoint(o){const a=ft.fromCoords(o);return this.center.equals(a.center)}neighbors(o){const[a,c]=(0,e.xy_to_axial_h)(this.center.x,this.center.y);return[new ft(new n.Point(...(0,e.axial_to_xy_h)(a+1,c))),new ft(new n.Point(...(0,e.axial_to_xy_h)(a-1,c))),new ft(new n.Point(...(0,e.axial_to_xy_h)(a,c+1))),new ft(new n.Point(...(0,e.axial_to_xy_h)(a,c-1))),new ft(new n.Point(...(0,e.axial_to_xy_h)(a+1,c-1))),new ft(new n.Point(...(0,e.axial_to_xy_h)(a-1,c+1)))]}};return Be.HHex=r,Be}var Ie={},kt={},Bs;function wi(){if(Bs)return kt;Bs=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.xy_to_uv_isometric=e,kt.uv_to_xy_isometric=i,kt.xy_to_uv_dimetric=r,kt.uv_to_xy_dimetric=s;const n=bt(),t=Math.sqrt(3);function e(o,a){const c=n.grid.dpi/t*3,l=n.grid.dpi;return[o/c+a/l,o/c-a/l]}function i(o,a){const c=n.grid.dpi/t*3,l=n.grid.dpi;return[(o+a)*c/2,(o-a)*l/2]}function r(o,a){const c=n.grid.dpi*2,l=n.grid.dpi;return[o/c+a/l,o/c-a/l]}function s(o,a){const c=n.grid.dpi*2,l=n.grid.dpi;return[(o+a)*c/2,(o-a)*l/2]}return kt}var Is;function vc(){if(Is)return Ie;Is=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Measure=void 0;const n=bt(),t=Ci(),e=wi();return Ie.Measure={euclidean:function(r){const s=r.map(a=>a.div(n.grid.dpi));let o=0;for(let a=1;a<s.length;a++)o+=s[a].distanceTo(s[a-1]);return o},chebyshevSquare:function(r){const s=r.map(a=>a.div(n.grid.dpi));let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.max(Math.abs(c.x-l.x),Math.abs(c.y-l.y))}return o},chebyshevVHex:function(r){const s=r.map(a=>{const[c,l]=(0,t.xy_to_axial_v)(a.x,a.y);return{q:c,r:l,s:-c-l}});let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.max(Math.abs(c.q-l.q),Math.abs(c.r-l.r),Math.abs(c.s-l.s))}return o},chebyshevHHex:function(r){const s=r.map(a=>{const[c,l]=(0,t.xy_to_axial_h)(a.x,a.y);return{q:c,r:l,s:-c-l}});let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.max(Math.abs(c.q-l.q),Math.abs(c.r-l.r),Math.abs(c.s-l.s))}return o},chebyshevIsometric:function(r){const s=r.map(a=>(0,e.xy_to_uv_isometric)(a.x,a.y));let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.max(Math.abs(c[0]-l[0]),Math.abs(c[1]-l[1]))}return o},chebyshevDimetric:function(r){const s=r.map(a=>(0,e.xy_to_uv_dimetric)(a.x,a.y));let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.max(Math.abs(c[0]-l[0]),Math.abs(c[1]-l[1]))}return o},manhattanSquare:function(r){const s=r.map(a=>a.div(n.grid.dpi));let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.abs(c.x-l.x)+Math.abs(c.y-l.y)}return o},manhattanIsometric:function(r){const s=r.map(a=>(0,e.xy_to_uv_isometric)(a.x,a.y));let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.abs(c[0]-l[0])+Math.abs(c[1]-l[1])}return o},manhattanDimetric:function(r){const s=r.map(a=>(0,e.xy_to_uv_dimetric)(a.x,a.y));let o=0;for(let a=1;a<s.length;a++){const c=s[a],l=s[a-1];o+=Math.abs(c[0]-l[0])+Math.abs(c[1]-l[1])}return o},alternatingSquare:function(r){const s=r.map(c=>c.div(n.grid.dpi));let o=0,a=0;for(let c=1;c<s.length;c++){const l=s[c],u=s[c-1];o+=Math.max(Math.abs(l.x-u.x),Math.abs(l.y-u.y)),a+=Math.min(Math.abs(l.x-u.x),Math.abs(l.y-u.y))}return o+Math.floor(a/2)},alternatingIsometric:function(r){const s=r.map(c=>(0,e.xy_to_uv_isometric)(c.x,c.y));let o=0,a=0;for(let c=1;c<s.length;c++){const l=s[c],u=s[c-1];o+=Math.max(Math.abs(l[0]-u[0]),Math.abs(l[1]-u[1])),a+=Math.min(Math.abs(l[0]-u[0]),Math.abs(l[1]-u[1]))}return o+Math.floor(a/2)},alternatingDimetric:function(r){const s=r.map(c=>(0,e.xy_to_uv_dimetric)(c.x,c.y));let o=0,a=0;for(let c=1;c<s.length;c++){const l=s[c],u=s[c-1];o+=Math.max(Math.abs(l[0]-u[0]),Math.abs(l[1]-u[1])),a+=Math.min(Math.abs(l[0]-u[0]),Math.abs(l[1]-u[1]))}return o+Math.floor(a/2)}},Ie}var Ne={},Pe={},Ns;function bi(){if(Ns)return Pe;Ns=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.BaseAxonometric=void 0;const n=an(),t=Et();let e=class extends n.Cell{constructor(r){super(),this.center=new t.Point(r)}nearestPointOnEdge(r){const s=t.Point.nearestPoint(r,this.corners),o=this.corners.filter(R=>R.x!=s.x&&R.y!=s.y),a=t.Point.nearestPoint(r,o),c=s.x,l=s.y,u=a.x,d=a.y,_=r.x,m=r.y,p=a.sub(s),A=new t.Point({x:p.y,y:-p.x}).add(r),C=A.x,S=A.y;return new t.Point({x:((c*d-l*u)*(_-C)-(c-u)*(_*S-m*C))/((c-u)*(m-S)-(l-d)*(_-C)),y:((c*d-l*u)*(m-S)-(l-d)*(_*S-m*C))/((c-u)*(m-S)-(l-d)*(_-C))})}};return Pe.BaseAxonometric=e,Pe}var Ps;function kr(){if(Ps)return Ne;Ps=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.Isometric=void 0;const n=Et(),t=bt(),e=wi(),i=bi(),r=Math.sqrt(3);let s=class at extends i.BaseAxonometric{static fromCoords(a){const c=t.grid.dpi-t.grid.hexRadius/4,l=new n.Point({x:a.x+c,y:a.y}),[u,d]=(0,e.xy_to_uv_isometric)(l.x,l.y),[_,m]=(0,e.uv_to_xy_isometric)(Math.round(u),Math.round(d));return new at({x:_-c,y:m})}get corners(){return[this.center.add({x:0,y:-t.grid.dpi/2}),this.center.add({x:+t.grid.dpi/r*1.5,y:0}),this.center.add({x:0,y:+t.grid.dpi/2}),this.center.add({x:-t.grid.dpi/r*1.5,y:0})]}toString(){return`Isometric${this.center}`}neighbors(a){const[c,l]=(0,e.xy_to_uv_isometric)(this.center.x,this.center.y),u=[new at(new n.Point(...(0,e.uv_to_xy_isometric)(c+1,l))),new at(new n.Point(...(0,e.uv_to_xy_isometric)(c,l+1))),new at(new n.Point(...(0,e.uv_to_xy_isometric)(c-1,l))),new at(new n.Point(...(0,e.uv_to_xy_isometric)(c,l-1)))],d=[new at(new n.Point(...(0,e.uv_to_xy_isometric)(c+1,l+1))),new at(new n.Point(...(0,e.uv_to_xy_isometric)(c+1,l-1))),new at(new n.Point(...(0,e.uv_to_xy_isometric)(c-1,l+1))),new at(new n.Point(...(0,e.uv_to_xy_isometric)(c-1,l-1)))];return[...u,...a?d:[]]}isAdjacent(a){const c=Math.abs(this.center.x-a.center.x),l=Math.abs(this.center.y-a.center.y);return Math.abs(c-t.grid.dpi/r*1.5)<.1&&Math.abs(l-t.grid.dpi/2)<.1}static iterateCellsBoundingPoints(a){let c=1/0,l=-1/0,u=1/0,d=-1/0;for(const m of a){const[p,f]=(0,e.xy_to_uv_isometric)(m.center.x,m.center.y);c=Math.min(c,p),l=Math.max(l,p),u=Math.min(u,f),d=Math.max(d,f)}const _=[];for(let m=Math.floor(c);m<=Math.ceil(l);m++)for(let p=Math.floor(u);p<=Math.ceil(d);p++){const[f,A]=(0,e.uv_to_xy_isometric)(m,p);_.push(at.fromCoords({x:f,y:A}))}return _}containsPoint(a){const c=at.fromCoords(a);return this.center.equals(c.center)}get axonometricCoords(){return(0,e.xy_to_uv_isometric)(this.center.x,this.center.y)}};return Ne.Isometric=s,Ne}var De={},Ds;function Ur(){if(Ds)return De;Ds=1,Object.defineProperty(De,"__esModule",{value:!0}),De.Dimetric=void 0;const n=Et(),t=bt(),e=wi(),i=bi();let r=class ct extends i.BaseAxonometric{static fromCoords(o){const a=t.grid.dpi,c=new n.Point({x:o.x+a,y:o.y}),[l,u]=(0,e.xy_to_uv_dimetric)(c.x,c.y),[d,_]=(0,e.uv_to_xy_dimetric)(Math.round(l),Math.round(u));return new ct({x:d-a,y:_})}get corners(){return[this.center.add({x:0,y:-t.grid.dpi/2}),this.center.add({x:+t.grid.dpi,y:0}),this.center.add({x:0,y:+t.grid.dpi/2}),this.center.add({x:-t.grid.dpi,y:0})]}toString(){return`Dimetric${this.center}`}neighbors(o){const[a,c]=(0,e.xy_to_uv_dimetric)(this.center.x,this.center.y),l=[new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a+1,c))),new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a,c+1))),new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a-1,c))),new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a,c-1)))],u=[new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a+1,c+1))),new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a+1,c-1))),new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a-1,c+1))),new ct(new n.Point(...(0,e.uv_to_xy_dimetric)(a-1,c-1)))];return[...l,...o?u:[]]}isAdjacent(o){const a=Math.abs(this.center.x-o.center.x),c=Math.abs(this.center.y-o.center.y);return Math.abs(a-t.grid.dpi)<.1&&Math.abs(c-t.grid.dpi/2)<.1}static iterateCellsBoundingPoints(o){let a=1/0,c=-1/0,l=1/0,u=-1/0;for(const _ of o){const[m,p]=(0,e.xy_to_uv_dimetric)(_.center.x,_.center.y);a=Math.min(a,m),c=Math.max(c,m),l=Math.min(l,p),u=Math.max(u,p)}const d=[];for(let _=Math.floor(a);_<=Math.ceil(c);_++)for(let m=Math.floor(l);m<=Math.ceil(u);m++){const[p,f]=(0,e.uv_to_xy_dimetric)(_,m);d.push(ct.fromCoords({x:p,y:f}))}return d}containsPoint(o){const a=ct.fromCoords(o);return this.center.equals(a.center)}get axonometricCoords(){return(0,e.xy_to_uv_dimetric)(this.center.x,this.center.y)}};return De.Dimetric=r,De}var Ls;function Rc(){if(Ls)return Ot;Ls=1;var n=Ot&&Ot.__awaiter||function(p,f,A,C){function S(R){return R instanceof A?R:new A(function(y){y(R)})}return new(A||(A=Promise))(function(R,y){function g(v){try{T(C.next(v))}catch(B){y(B)}}function x(v){try{T(C.throw(v))}catch(B){y(B)}}function T(v){v.done?R(v.value):S(v.value).then(g,x)}T((C=C.apply(p,f||[])).next())})},t=Ot&&Ot.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.Grid=void 0;const e=t(yt),i=Nr(),r=an(),s=Dr(),o=Lr(),a=Et(),c=$r(),l=vc(),u=kr(),d=Ur(),_=Math.sqrt(3);let m=class We{constructor(){this.readyPromises=[]}init(){return n(this,void 0,void 0,function*(){if(e.default.scene.grid.onChange(f=>n(this,void 0,void 0,function*(){this.gridData=f,this.scaleData=yield e.default.scene.grid.getScale(),this.readyPromises.forEach(A=>A()),this.readyPromises=[]})),yield e.default.scene.isReady()){const f={dpi:e.default.scene.grid.getDpi(),measurement:e.default.scene.grid.getMeasurement(),scale:e.default.scene.grid.getScale(),style:{lineType:e.default.scene.grid.getLineType(),lineOpacity:e.default.scene.grid.getOpacity(),lineColor:e.default.scene.grid.getColor(),lineWidth:e.default.scene.grid.getLineWidth()},type:e.default.scene.grid.getType()};this.gridData={dpi:yield f.dpi,measurement:yield f.measurement,scale:(yield f.scale).raw,style:{lineType:yield f.style.lineType,lineOpacity:yield f.style.lineOpacity,lineColor:yield f.style.lineColor,lineWidth:yield f.style.lineWidth},type:yield f.type},this.scaleData=yield f.scale,this.readyPromises.forEach(A=>A()),this.readyPromises=[]}})}awaitReady(){return n(this,void 0,void 0,function*(){return this.gridData?Promise.resolve():new Promise(f=>{this.readyPromises.push(f)})})}static getInstance(){return We.instance||(We.instance=new We),We.instance}fake(f,A){this.gridData=f,this.scaleData=A}get dpi(){if(!this.gridData)throw new Error("Grid data not loaded yet");return this.gridData.dpi}get hexRadius(){if(!this.gridData)throw new Error("Grid data not loaded yet");return this.gridData.dpi/_}get style(){if(!this.gridData)throw new Error("Grid data not loaded yet");return this.gridData.style}get type(){if(!this.gridData)throw new Error("Grid data not loaded yet");return this.gridData.type}get measurement(){if(!this.gridData)throw new Error("Grid data not loaded yet");return this.gridData.measurement}get scale(){if(!this.gridData)throw new Error("Grid data not loaded yet");return this.gridData.scale}get gridScale(){if(!this.scaleData)throw new Error("Grid data not loaded yet");return this.scaleData}getCell(f){if(!this.gridData)throw new Error("Grid data not loaded yet");if(this.gridData.type==="SQUARE")return s.Square.fromCoords(f);if(this.gridData.type==="HEX_VERTICAL")return o.VHex.fromCoords(f);if(this.gridData.type==="HEX_HORIZONTAL")return c.HHex.fromCoords(f);if(this.gridData.type==="ISOMETRIC")return u.Isometric.fromCoords(f);if(this.gridData.type==="DIMETRIC")return d.Dimetric.fromCoords(f);throw new Error(`Grid type "${this.gridData.type}" not supported`)}snapTo(f,A){const C=this.getCell(f),S=[];return A&i.SnapTo.CENTER&&S.push(C.center),A&i.SnapTo.CORNER&&S.push(...C.corners),A&i.SnapTo.EDGE&&S.push(C.nearestPointOnEdge(f)),S.length===0?new a.Point(f):S.length===1?S[0]:a.Point.nearestPoint(f,S)}measure(...f){if(!this.gridData)throw new Error("Grid data not loaded yet");const A=f.map(C=>C instanceof r.Cell?C.center:new a.Point(C));return this.gridData.measurement=="EUCLIDEAN"?l.Measure.euclidean(A):this.gridData.type==="SQUARE"&&this.gridData.measurement==="CHEBYSHEV"?l.Measure.chebyshevSquare(A):this.gridData.type==="HEX_VERTICAL"&&this.gridData.measurement==="CHEBYSHEV"?l.Measure.chebyshevVHex(A):this.gridData.type==="HEX_HORIZONTAL"&&this.gridData.measurement==="CHEBYSHEV"?l.Measure.chebyshevHHex(A):this.gridData.type==="ISOMETRIC"&&this.gridData.measurement==="CHEBYSHEV"?l.Measure.chebyshevIsometric(A):this.gridData.type==="DIMETRIC"&&this.gridData.measurement==="CHEBYSHEV"?l.Measure.chebyshevDimetric(A):this.gridData.type==="SQUARE"&&this.gridData.measurement==="MANHATTAN"?l.Measure.manhattanSquare(A):this.gridData.type==="ISOMETRIC"&&this.gridData.measurement==="MANHATTAN"?l.Measure.manhattanIsometric(A):this.gridData.type==="DIMETRIC"&&this.gridData.measurement==="MANHATTAN"?l.Measure.manhattanDimetric(A):this.gridData.type==="SQUARE"&&this.gridData.measurement==="ALTERNATING"?l.Measure.alternatingSquare(A):this.gridData.type==="ISOMETRIC"&&this.gridData.measurement==="ALTERNATING"?l.Measure.alternatingIsometric(A):this.gridData.type==="DIMETRIC"&&this.gridData.measurement==="ALTERNATING"?l.Measure.alternatingDimetric(A):0}getNearestSnapType(f){if(!this.gridData)throw new Error("Grid data not loaded yet");const A=this.getCell(f);return this.snapTo(f,i.SnapTo.ALL).equals(A.center)?i.SnapTo.CENTER:i.SnapTo.CORNER}iterateCellsBoundingPoints(f){if(!this.gridData)throw new Error("Grid data not loaded yet");if(f.length===0)return[];if(f[0]instanceof s.Square)return s.Square.iterateCellsBoundingPoints(f);if(this.gridData.type==="HEX_VERTICAL")return o.VHex.iterateCellsBoundingPoints(f);if(this.gridData.type==="HEX_HORIZONTAL")return c.HHex.iterateCellsBoundingPoints(f);if(this.gridData.type==="ISOMETRIC")return u.Isometric.iterateCellsBoundingPoints(f);if(this.gridData.type==="DIMETRIC")return d.Dimetric.iterateCellsBoundingPoints(f);throw new Error(`Grid type "${this.gridData.type}" not supported`)}};return Ot.Grid=m,Ot}var vt={},Ut={},It={},$s;function Hr(){if($s)return It;$s=1;var n=It&&It.__awaiter||function(r,s,o,a){function c(l){return l instanceof o?l:new o(function(u){u(l)})}return new(o||(o=Promise))(function(l,u){function d(p){try{m(a.next(p))}catch(f){u(f)}}function _(p){try{m(a.throw(p))}catch(f){u(f)}}function m(p){p.done?l(p.value):c(p.value).then(d,_)}m((a=a.apply(r,s||[])).next())})},t=It&&It.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(It,"__esModule",{value:!0}),It.awaitReady=i;const e=t(yt);function i(){return n(this,void 0,void 0,function*(){return e.default.isReady?Promise.resolve():new Promise(r=>{e.default.onReady(r)})})}return It}var Tn={},ks;function Gr(){if(ks)return Tn;ks=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.cleanMetadata=n;function n(t,e){const i=Object.assign({},e);if(t)for(const r in e)t[r]!==void 0&&t[r]!==null&&(i[r]=t[r]);return i}return Tn}var Us;function cn(){if(Us)return Ut;Us=1;var n=Ut&&Ut.__awaiter||function(r,s,o,a){function c(l){return l instanceof o?l:new o(function(u){u(l)})}return new(o||(o=Promise))(function(l,u){function d(p){try{m(a.next(p))}catch(f){u(f)}}function _(p){try{m(a.throw(p))}catch(f){u(f)}}function m(p){p.done?l(p.value):c(p.value).then(d,_)}m((a=a.apply(r,s||[])).next())})};Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.BaseMetadataMapper=void 0;const t=Hr(),e=Gr();class i{constructor(s,o){this.key=s,this.defaultValues=o}setDefaultValues(s){return(0,e.cleanMetadata)(s,this.defaultValues)}clean(s){return this.setDefaultValues(s)}cleanRawMetadata(s){return this.setDefaultValues(this.transformLoadingValues(s))}transformLoadingValues(s){return s}transformSavingValues(s){return s}get(){return n(this,void 0,void 0,function*(){return yield(0,t.awaitReady)(),this.cleanRawMetadata(yield this.getRawMetadata())})}set(s){return n(this,void 0,void 0,function*(){yield(0,t.awaitReady)();const o=yield this.get(),a=Object.assign(Object.assign({},o),s);return yield this.setRawMetadata(this.transformSavingValues(a)),a})}}return Ut.BaseMetadataMapper=i,Ut}var Hs;function Mc(){if(Hs)return vt;Hs=1;var n=vt&&vt.__awaiter||function(s,o,a,c){function l(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function _(f){try{p(c.next(f))}catch(A){d(A)}}function m(f){try{p(c.throw(f))}catch(A){d(A)}}function p(f){f.done?u(f.value):l(f.value).then(_,m)}p((c=c.apply(s,o||[])).next())})},t=vt&&vt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(vt,"__esModule",{value:!0}),vt.ToolMetadataMapper=void 0;const e=t(yt),i=cn();class r extends i.BaseMetadataMapper{getRawMetadata(){return n(this,void 0,void 0,function*(){return(yield e.default.tool.getMetadata(this.key))||{}})}setRawMetadata(o){return n(this,void 0,void 0,function*(){return e.default.tool.setMetadata(this.key,o)})}}return vt.ToolMetadataMapper=r,vt}var Rt={},Gs;function Vr(){if(Gs)return Rt;Gs=1;var n=Rt&&Rt.__awaiter||function(s,o,a,c){function l(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function _(f){try{p(c.next(f))}catch(A){d(A)}}function m(f){try{p(c.throw(f))}catch(A){d(A)}}function p(f){f.done?u(f.value):l(f.value).then(_,m)}p((c=c.apply(s,o||[])).next())})},t=Rt&&Rt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.RoomMetadataMapper=void 0;const e=t(yt),i=cn();class r extends i.BaseMetadataMapper{getRawMetadata(){return n(this,void 0,void 0,function*(){return((yield e.default.room.getMetadata())||{})[this.key]||{}})}setRawMetadata(o){return n(this,void 0,void 0,function*(){return e.default.room.setMetadata({[this.key]:o})})}}return Rt.RoomMetadataMapper=r,Rt}var Le={},Vs;function Cc(){if(Vs)return Le;Vs=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.ItemMetadataMapper=void 0;const n=Gr();class t{constructor(i,r){this.key=i,this.defaultValues=r}setDefaultValues(i){return(0,n.cleanMetadata)(i,this.defaultValues)}clean(i){return this.setDefaultValues(i)}get(i){const r=i.metadata[this.key]||{};return this.setDefaultValues(r)}set(i,r){const s=this.get(i),o=Object.assign(Object.assign({},s),r);return i.metadata[this.key]=Object.assign(Object.assign({},s),r),o}}return Le.ItemMetadataMapper=t,Le}var Mt={},Fs;function Fr(){if(Fs)return Mt;Fs=1;var n=Mt&&Mt.__awaiter||function(s,o,a,c){function l(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function _(f){try{p(c.next(f))}catch(A){d(A)}}function m(f){try{p(c.throw(f))}catch(A){d(A)}}function p(f){f.done?u(f.value):l(f.value).then(_,m)}p((c=c.apply(s,o||[])).next())})},t=Mt&&Mt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.SceneMetadataMapper=void 0;const e=t(yt),i=cn();class r extends i.BaseMetadataMapper{getRawMetadata(){return n(this,void 0,void 0,function*(){return((yield e.default.scene.getMetadata())||{})[this.key]||{}})}setRawMetadata(o){return n(this,void 0,void 0,function*(){return e.default.scene.setMetadata({[this.key]:o})})}}return Mt.SceneMetadataMapper=r,Mt}var Ct={},Ws;function Wr(){if(Ws)return Ct;Ws=1;var n=Ct&&Ct.__awaiter||function(s,o,a,c){function l(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function _(f){try{p(c.next(f))}catch(A){d(A)}}function m(f){try{p(c.throw(f))}catch(A){d(A)}}function p(f){f.done?u(f.value):l(f.value).then(_,m)}p((c=c.apply(s,o||[])).next())})},t=Ct&&Ct.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.PlayerMetadataMapper=void 0;const e=t(yt),i=cn();class r extends i.BaseMetadataMapper{getRawMetadata(){return n(this,void 0,void 0,function*(){return((yield e.default.player.getMetadata())||{})[this.key]||{}})}setRawMetadata(o){return n(this,void 0,void 0,function*(){return e.default.player.setMetadata({[this.key]:o})})}}return Ct.PlayerMetadataMapper=r,Ct}var Ht={},St={},js;function Bi(){if(js)return St;js=1;var n=St&&St.__awaiter||function(s,o,a,c){function l(u){return u instanceof a?u:new a(function(d){d(u)})}return new(a||(a=Promise))(function(u,d){function _(f){try{p(c.next(f))}catch(A){d(A)}}function m(f){try{p(c.throw(f))}catch(A){d(A)}}function p(f){f.done?u(f.value):l(f.value).then(_,m)}p((c=c.apply(s,o||[])).next())})},t=St&&St.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(St,"__esModule",{value:!0}),St.BaseCachedMetadata=void 0;const e=t(yt),i=cn();class r{constructor(o,a){if(o instanceof i.BaseMetadataMapper)this.mapper=o;else if(typeof a<"u")this.mapper=this.createMapper(o,a);else throw new Error("Invalid arguments");e.default.onReady(()=>{this.setupEvent(c=>{this.metadata=this.mapper.cleanRawMetadata(c)})}),this.metadata=this.mapper.defaultValues,this.readyPromise=new Promise(c=>{this.mapper.get().then(l=>{this.metadata=l,c()})})}get key(){return this.mapper.key}get defaultValues(){return this.mapper.defaultValues}awaitReady(){return n(this,void 0,void 0,function*(){return this.readyPromise})}get data(){return this.metadata}get(o){return this.metadata[o]}set(o,a){return n(this,void 0,void 0,function*(){return typeof o=="string"&&(o={[o]:a}),this.metadata=Object.assign(Object.assign({},this.metadata),o),this.mapper.set(o)})}}return St.BaseCachedMetadata=r,St}var qs;function Sc(){if(qs)return Ht;qs=1;var n=Ht&&Ht.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.CachedPlayerMetadata=void 0;const t=n(yt),e=Bi(),i=Wr();class r extends e.BaseCachedMetadata{setupEvent(o){t.default.player.onChange(a=>{o(a.metadata[this.key])})}createMapper(o,a){return new i.PlayerMetadataMapper(o,a)}}return Ht.CachedPlayerMetadata=r,Ht}var Gt={},zs;function wc(){if(zs)return Gt;zs=1;var n=Gt&&Gt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.CachedRoomMetadata=void 0;const t=Vr(),e=n(yt),i=Bi();class r extends i.BaseCachedMetadata{setupEvent(o){e.default.room.onMetadataChange(a=>{o(a[this.key])})}createMapper(o,a){return new t.RoomMetadataMapper(o,a)}}return Gt.CachedRoomMetadata=r,Gt}var Vt={},Ys;function bc(){if(Ys)return Vt;Ys=1;var n=Vt&&Vt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.CachedSceneMetadata=void 0;const t=n(yt),e=Bi(),i=Fr();class r extends e.BaseCachedMetadata{setupEvent(o){t.default.scene.onMetadataChange(a=>{o(a[this.key])})}createMapper(o,a){return new i.SceneMetadataMapper(o,a)}}return Vt.CachedSceneMetadata=r,Vt}var Xs;function bt(){return Xs||(Xs=1,function(n){var t=Oe&&Oe.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(n,"__esModule",{value:!0}),n.grid=n.awaitReady=n.CachedSceneMetadata=n.CachedRoomMetadata=n.CachedPlayerMetadata=n.PlayerMetadataMapper=n.SceneMetadataMapper=n.ItemMetadataMapper=n.RoomMetadataMapper=n.ToolMetadataMapper=n.Grid=n.SnapTo=n.Dimetric=n.Isometric=n.BaseAxonometric=n.HHex=n.VHex=n.BaseHex=n.Square=n.Cell=n.LineSegment=n.Point=void 0;const e=t(yt),i=Rc();Object.defineProperty(n,"Grid",{enumerable:!0,get:function(){return i.Grid}});var r=Et();Object.defineProperty(n,"Point",{enumerable:!0,get:function(){return r.Point}});var s=Pr();Object.defineProperty(n,"LineSegment",{enumerable:!0,get:function(){return s.LineSegment}});var o=an();Object.defineProperty(n,"Cell",{enumerable:!0,get:function(){return o.Cell}});var a=Dr();Object.defineProperty(n,"Square",{enumerable:!0,get:function(){return a.Square}});var c=Si();Object.defineProperty(n,"BaseHex",{enumerable:!0,get:function(){return c.BaseHex}});var l=Lr();Object.defineProperty(n,"VHex",{enumerable:!0,get:function(){return l.VHex}});var u=$r();Object.defineProperty(n,"HHex",{enumerable:!0,get:function(){return u.HHex}});var d=bi();Object.defineProperty(n,"BaseAxonometric",{enumerable:!0,get:function(){return d.BaseAxonometric}});var _=kr();Object.defineProperty(n,"Isometric",{enumerable:!0,get:function(){return _.Isometric}});var m=Ur();Object.defineProperty(n,"Dimetric",{enumerable:!0,get:function(){return m.Dimetric}});var p=Nr();Object.defineProperty(n,"SnapTo",{enumerable:!0,get:function(){return p.SnapTo}});var f=Mc();Object.defineProperty(n,"ToolMetadataMapper",{enumerable:!0,get:function(){return f.ToolMetadataMapper}});var A=Vr();Object.defineProperty(n,"RoomMetadataMapper",{enumerable:!0,get:function(){return A.RoomMetadataMapper}});var C=Cc();Object.defineProperty(n,"ItemMetadataMapper",{enumerable:!0,get:function(){return C.ItemMetadataMapper}});var S=Fr();Object.defineProperty(n,"SceneMetadataMapper",{enumerable:!0,get:function(){return S.SceneMetadataMapper}});var R=Wr();Object.defineProperty(n,"PlayerMetadataMapper",{enumerable:!0,get:function(){return R.PlayerMetadataMapper}});var y=Sc();Object.defineProperty(n,"CachedPlayerMetadata",{enumerable:!0,get:function(){return y.CachedPlayerMetadata}});var g=wc();Object.defineProperty(n,"CachedRoomMetadata",{enumerable:!0,get:function(){return g.CachedRoomMetadata}});var x=bc();Object.defineProperty(n,"CachedSceneMetadata",{enumerable:!0,get:function(){return x.CachedSceneMetadata}});var T=Hr();Object.defineProperty(n,"awaitReady",{enumerable:!0,get:function(){return T.awaitReady}}),n.grid=i.Grid.getInstance(),e.default.onReady(()=>{n.grid.init()})}(Oe)),Oe}var D=bt();const Ks="cthulu";function wt(n){return n?`${Ks}/${n}`:Ks}class Bc extends D.Cell{constructor(t,e){super(),this._center=t,this._size=e}get center(){return this._center}get corners(){const t=this._size/2;return[new D.Point({x:this._center.x-t,y:this._center.y-t}),new D.Point({x:this._center.x+t,y:this._center.y-t}),new D.Point({x:this._center.x+t,y:this._center.y+t}),new D.Point({x:this._center.x-t,y:this._center.y+t})]}get edges(){const t=this.corners;return[new D.LineSegment(t[0],t[1]),new D.LineSegment(t[1],t[2]),new D.LineSegment(t[2],t[3]),new D.LineSegment(t[3],t[0])]}containsPoint(t){const e=this._size/2;return t.x>=this._center.x-e&&t.x<=this._center.x+e&&t.y>=this._center.y-e&&t.y<=this._center.y+e}nearestPointOnEdge(t){const e=this._size/2,i=Math.max(this._center.x-e,Math.min(t.x,this._center.x+e)),r=Math.max(this._center.y-e,Math.min(t.y,this._center.y+e));return new D.Point({x:i,y:r})}toString(){return`[${this._center.x}, ${this._center.y}]`}neighbors(t){return[]}}let _e=null,I=[],gt=null,te=0,mi=0;function Ic(){L.tool.onToolModeChange(async n=>{if(gt&&n!==wt("movement-mode")&&n!==wt("movement-confirm")){const[,t]=gt;t(),gt=null,_e=null,I=[]}}),L.tool.createMode({id:wt("movement-mode"),icons:[{icon:"https://ldarki.github.io/cthulhu-owlbear/move-icon.svg",label:"Movement Mode"}],cursors:[{cursor:"pointer"}],shortcut:"Shift+D",onToolMove:async()=>{await Qn()},onToolClick:async(n,t)=>{if(!gt){const[a,c,l]=await Nc();gt=await L.interaction.startItemInteraction([a,c,l])}const{x:e,y:i}=t.pointerPosition,r=await Dc(e,i),s=(r==null?void 0:r.center)??{x:0,y:0};if(r&&I.length==0){const a=new Bc(s,te);if(I.push(a),_e===r.id)return;_e=r.id}const o=await Lc(e,i);if(!r&&I.length!=0&&o){const a=D.grid.getCell(D.grid.snapTo({x:e,y:i},D.SnapTo.CENTER)),c=I.findIndex(l=>Math.abs(l.center.x-a.center.x)<.5&&Math.abs(l.center.y-a.center.y)<.5);c!==-1?(I.splice(c,1),await Qn()):(I.push(a),await Qn())}}}),L.tool.createMode({id:wt("movement-confirm"),icons:[{icon:"https://ldarki.github.io/cthulhu-owlbear/confirm-icon.svg",label:"Confirm Movement"}],shortcut:"Shift+C",onActivate:async()=>{if(!gt)return;const[,n]=gt;n(),await kc(_e,I),gt=null,_e=null,I=[]}})}async function Nc(){const n=await L.player.getColor(),t=pi();t.position({x:0,y:0}),t.metadata({createdBy:wt()}),t.strokeWidth(2),t.layer("DRAWING"),t.name("Cthulhu Highlight"),t.strokeColor(n),t.fillColor(Pc(n,.4)),t.commands([]);const e=pi();e.position({x:0,y:0}),e.metadata({createdBy:wt()}),e.strokeColor("red"),e.strokeWidth(4),e.fillOpacity(0),e.layer("DRAWING"),e.name("Cthulhu Arrow"),e.commands([]);const i=Ir().plainText("");i.position({x:0,y:0}),i.metadata({createdBy:wt()}),i.pointerWidth(0),i.pointerHeight(0),i.locked(!0),i.layer("DRAWING"),i.name("Cthulhu Label");const r=t.build(),s=e.build(),o=i.build();return[r,s,o]}async function Qn(){if(!gt)return;L.player.select([_e??""]);const n=[];for(const i of I){const r=i;if(!r)continue;const s=r.corners;n.push([Q.MOVE,s[0].x,s[1].y]);for(const o of s)n.push([Q.LINE,o.x,o.y]);n.push([Q.CLOSE])}const t=[];if(I.length>=2){const i=I[0].center,r=I[1].center,s=(i.x+r.x)/2,o=(i.y+r.y)/2;t.push([Q.MOVE,i.x,i.y]),t.push([Q.LINE,s,o]);for(let a=1;a<I.length;a++)if(a===I.length-1){const c=I[a-1].center,l=new D.Point((c.x+I[a].center.x)/2,(c.y+I[a].center.y)/2),u=I[a].center,d=te/6,_=u.x-l.x,m=u.y-l.y,p=Math.atan2(m,_),f=u.x-d*Math.cos(p-Math.PI/6),A=u.y-d*Math.sin(p-Math.PI/6),C=u.x-d*Math.cos(p+Math.PI/6),S=u.y-d*Math.sin(p+Math.PI/6);t.push([Q.MOVE,l.x,l.y]),t.push([Q.LINE,u.x,u.y]),t.push([Q.MOVE,u.x,u.y]),t.push([Q.LINE,f,A]),t.push([Q.MOVE,u.x,u.y]),t.push([Q.LINE,C,S])}else{const c=I[a],l=new D.Point((I[a].center.x+I[a+1].center.x)/2,(I[a].center.y+I[a+1].center.y)/2);t.push([Q.CONIC,c.center.x,c.center.y,l.x,l.y,.9])}}const[e]=gt;e(i=>{const[r,s,o]=i;r.commands=n;const a=(I.length-1)*te,c=`${Math.round(a/D.grid.dpi*(D.grid.gridScale.parsed.multiplier||0))}${D.grid.gridScale.parsed.unit||""}`;o.position={x:I[I.length-1].center.x,y:I[I.length-1].center.y},o.text.plainText=c,s.commands=t})}function Pc(n,t=1){n=n.replace(/^#/,""),n.length===3&&(n=n.split("").map(s=>s+s).join(""));const e=parseInt(n.substring(0,2),16),i=parseInt(n.substring(2,4),16),r=parseInt(n.substring(4,6),16);return`rgba(${e}, ${i}, ${r}, ${t})`}async function Dc(n,t){const e=new D.Point(n,t),i=await L.scene.items.getItems();for(let r of i)if(r.type==="IMAGE"){const s=new D.Point(r.position.x,r.position.y);if(s.distanceTo(e)<=te/2)return{id:r.id,center:s}}return null}async function Lc(n,t){if(I.length===0)return!1;const e=I[I.length-1],i=Zs(n,t,te,mi),r=Zs(e.center.x,e.center.y,te,mi),s=Math.abs(i.x-r.x),o=Math.abs(i.y-r.y);return s<=1&&o<=1}function Zs(n,t,e,i){return{x:Math.floor(n/e),y:Math.floor(t/i)}}async function Qs(){const t=D.grid.getCell(D.grid.snapTo({x:0,y:0},D.SnapTo.CENTER)).corners;te=Math.hypot(t[1].x-t[0].x,t[1].y-t[0].y),mi=Math.hypot(t[3].x-t[0].x,t[3].y-t[0].y)}function $c(n){return new Promise(t=>setTimeout(t,n))}async function kc(n,t,e=2){if(!(!n||t.length<2))for(let i=1;i<t.length;i++){const r=t[i-1].center,s=t[i].center,o=(s.x-r.x)/e,a=(s.y-r.y)/e;for(let c=1;c<=e;c++){const l=r.x+o*c,u=r.y+a*c;await L.scene.items.updateItems([n],d=>{d[0].position={x:l,y:u},d[0].disableHit=!0,c==e&&(d[0].disableHit=!1)}),await $c(100)}}}let On=null;function Uc(){L.player.onChange(async n=>{n.selection&&n.selection.length>0&&(On=n.selection[0])}),L.tool.create({id:wt("zoom-img"),icons:[{icon:"https://ldarki.github.io/cthulhu-owlbear/zoom-icon.svg",label:"Zoom Image"}],shortcut:"Shift+Z",onClick:async()=>{var e;if(!On)return!1;const n=await L.scene.items.getItems([On]);if(!n||n.length===0||n[0].type!=="IMAGE")return console.warn("Item invlido o no encontrado:",On),!1;const t=(e=n[0].image)==null?void 0:e.url;if(!t)return!1;await L.player.deselect(),await L.modal.open({id:wt("zoom-modal"),url:`https://ldarki.github.io/cthulhu-owlbear/modal.html?image=${encodeURIComponent(t)}`,width:400,height:500,hidePaper:!0})}})}L.onReady(async()=>{await D.grid.awaitReady(),await Qs(),L.scene.grid.onChange(async()=>{await Qs()}),Ic(),Uc()});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Cn=globalThis,Ii=Cn.ShadowRoot&&(Cn.ShadyCSS===void 0||Cn.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,jr=Symbol(),Js=new WeakMap;let Hc=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==jr)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(Ii&&t===void 0){const i=e!==void 0&&e.length===1;i&&(t=Js.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&Js.set(e,t))}return t}toString(){return this.cssText}};const Gc=n=>new Hc(typeof n=="string"?n:n+"",void 0,jr),Vc=(n,t)=>{if(Ii)n.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),r=Cn.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=e.cssText,n.appendChild(i)}},tr=Ii?n=>n:n=>n instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return Gc(e)})(n):n;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Fc,defineProperty:Wc,getOwnPropertyDescriptor:jc,getOwnPropertyNames:qc,getOwnPropertySymbols:zc,getPrototypeOf:Yc}=Object,Pt=globalThis,er=Pt.trustedTypes,Xc=er?er.emptyScript:"",Jn=Pt.reactiveElementPolyfillSupport,ze=(n,t)=>n,Bn={toAttribute(n,t){switch(t){case Boolean:n=n?Xc:null;break;case Object:case Array:n=n==null?n:JSON.stringify(n)}return n},fromAttribute(n,t){let e=n;switch(t){case Boolean:e=n!==null;break;case Number:e=n===null?null:Number(n);break;case Object:case Array:try{e=JSON.parse(n)}catch{e=null}}return e}},Ni=(n,t)=>!Fc(n,t),nr={attribute:!0,type:String,converter:Bn,reflect:!1,hasChanged:Ni};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Pt.litPropertyMetadata??(Pt.litPropertyMetadata=new WeakMap);class ye extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=nr){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,e);r!==void 0&&Wc(this.prototype,t,r)}}static getPropertyDescriptor(t,e,i){const{get:r,set:s}=jc(this.prototype,t)??{get(){return this[e]},set(o){this[e]=o}};return{get(){return r==null?void 0:r.call(this)},set(o){const a=r==null?void 0:r.call(this);s.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??nr}static _$Ei(){if(this.hasOwnProperty(ze("elementProperties")))return;const t=Yc(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(ze("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(ze("properties"))){const e=this.properties,i=[...qc(e),...zc(e)];for(const r of i)this.createProperty(r,e[r])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[i,r]of e)this.elementProperties.set(i,r)}this._$Eh=new Map;for(const[e,i]of this.elementProperties){const r=this._$Eu(e,i);r!==void 0&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const r of i)e.unshift(tr(r))}else t!==void 0&&e.push(tr(t));return e}static _$Eu(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Vc(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostConnected)==null?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EC(t,e){var s;const i=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,i);if(r!==void 0&&i.reflect===!0){const o=(((s=i.converter)==null?void 0:s.toAttribute)!==void 0?i.converter:Bn).toAttribute(e,i.type);this._$Em=t,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(t,e){var s;const i=this.constructor,r=i._$Eh.get(t);if(r!==void 0&&this._$Em!==r){const o=i.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((s=o.converter)==null?void 0:s.fromAttribute)!==void 0?o.converter:Bn;this._$Em=r,this[r]=a.fromAttribute(e,o.type),this._$Em=null}}requestUpdate(t,e,i){if(t!==void 0){if(i??(i=this.constructor.getPropertyOptions(t)),!(i.hasChanged??Ni)(this[t],e))return;this.P(t,e,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,i){this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$Em!==t&&(this._$Ej??(this._$Ej=new Set)).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[s,o]of this._$Ep)this[s]=o;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[s,o]of r)o.wrapped!==!0||this._$AL.has(s)||this[s]===void 0||this.P(s,this[s],o)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(i=this._$EO)==null||i.forEach(r=>{var s;return(s=r.hostUpdate)==null?void 0:s.call(r)}),this.update(e)):this._$EU()}catch(r){throw t=!1,this._$EU(),r}t&&this._$AE(e)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(i=>{var r;return(r=i.hostUpdated)==null?void 0:r.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EC(e,this[e]))),this._$EU()}updated(t){}firstUpdated(t){}}ye.elementStyles=[],ye.shadowRootOptions={mode:"open"},ye[ze("elementProperties")]=new Map,ye[ze("finalized")]=new Map,Jn==null||Jn({ReactiveElement:ye}),(Pt.reactiveElementVersions??(Pt.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ye=globalThis,In=Ye.trustedTypes,ir=In?In.createPolicy("lit-html",{createHTML:n=>n}):void 0,qr="$lit$",Nt=`lit$${Math.random().toFixed(9).slice(2)}$`,zr="?"+Nt,Kc=`<${zr}>`,ee=document,Je=()=>ee.createComment(""),tn=n=>n===null||typeof n!="object"&&typeof n!="function",Pi=Array.isArray,Zc=n=>Pi(n)||typeof(n==null?void 0:n[Symbol.iterator])=="function",ti=`[ 	
\f\r]`,$e=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,sr=/-->/g,rr=/>/g,Ft=RegExp(`>|${ti}(?:([^\\s"'>=/]+)(${ti}*=${ti}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),or=/'/g,ar=/"/g,Yr=/^(?:script|style|textarea|title)$/i,Qc=n=>(t,...e)=>({_$litType$:n,strings:t,values:e}),Dt=Qc(1),ne=Symbol.for("lit-noChange"),H=Symbol.for("lit-nothing"),cr=new WeakMap,Yt=ee.createTreeWalker(ee,129);function Xr(n,t){if(!Pi(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return ir!==void 0?ir.createHTML(t):t}const Jc=(n,t)=>{const e=n.length-1,i=[];let r,s=t===2?"<svg>":t===3?"<math>":"",o=$e;for(let a=0;a<e;a++){const c=n[a];let l,u,d=-1,_=0;for(;_<c.length&&(o.lastIndex=_,u=o.exec(c),u!==null);)_=o.lastIndex,o===$e?u[1]==="!--"?o=sr:u[1]!==void 0?o=rr:u[2]!==void 0?(Yr.test(u[2])&&(r=RegExp("</"+u[2],"g")),o=Ft):u[3]!==void 0&&(o=Ft):o===Ft?u[0]===">"?(o=r??$e,d=-1):u[1]===void 0?d=-2:(d=o.lastIndex-u[2].length,l=u[1],o=u[3]===void 0?Ft:u[3]==='"'?ar:or):o===ar||o===or?o=Ft:o===sr||o===rr?o=$e:(o=Ft,r=void 0);const m=o===Ft&&n[a+1].startsWith("/>")?" ":"";s+=o===$e?c+Kc:d>=0?(i.push(l),c.slice(0,d)+qr+c.slice(d)+Nt+m):c+Nt+(d===-2?a:m)}return[Xr(n,s+(n[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};class en{constructor({strings:t,_$litType$:e},i){let r;this.parts=[];let s=0,o=0;const a=t.length-1,c=this.parts,[l,u]=Jc(t,e);if(this.el=en.createElement(l,i),Yt.currentNode=this.el.content,e===2||e===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(r=Yt.nextNode())!==null&&c.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const d of r.getAttributeNames())if(d.endsWith(qr)){const _=u[o++],m=r.getAttribute(d).split(Nt),p=/([.?@])?(.*)/.exec(_);c.push({type:1,index:s,name:p[2],strings:m,ctor:p[1]==="."?eu:p[1]==="?"?nu:p[1]==="@"?iu:Pn}),r.removeAttribute(d)}else d.startsWith(Nt)&&(c.push({type:6,index:s}),r.removeAttribute(d));if(Yr.test(r.tagName)){const d=r.textContent.split(Nt),_=d.length-1;if(_>0){r.textContent=In?In.emptyScript:"";for(let m=0;m<_;m++)r.append(d[m],Je()),Yt.nextNode(),c.push({type:2,index:++s});r.append(d[_],Je())}}}else if(r.nodeType===8)if(r.data===zr)c.push({type:2,index:s});else{let d=-1;for(;(d=r.data.indexOf(Nt,d+1))!==-1;)c.push({type:7,index:s}),d+=Nt.length-1}s++}}static createElement(t,e){const i=ee.createElement("template");return i.innerHTML=t,i}}function pe(n,t,e=n,i){var o,a;if(t===ne)return t;let r=i!==void 0?(o=e._$Co)==null?void 0:o[i]:e._$Cl;const s=tn(t)?void 0:t._$litDirective$;return(r==null?void 0:r.constructor)!==s&&((a=r==null?void 0:r._$AO)==null||a.call(r,!1),s===void 0?r=void 0:(r=new s(n),r._$AT(n,e,i)),i!==void 0?(e._$Co??(e._$Co=[]))[i]=r:e._$Cl=r),r!==void 0&&(t=pe(n,r._$AS(n,t.values),r,i)),t}class tu{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,r=((t==null?void 0:t.creationScope)??ee).importNode(e,!0);Yt.currentNode=r;let s=Yt.nextNode(),o=0,a=0,c=i[0];for(;c!==void 0;){if(o===c.index){let l;c.type===2?l=new un(s,s.nextSibling,this,t):c.type===1?l=new c.ctor(s,c.name,c.strings,this,t):c.type===6&&(l=new su(s,this,t)),this._$AV.push(l),c=i[++a]}o!==(c==null?void 0:c.index)&&(s=Yt.nextNode(),o++)}return Yt.currentNode=ee,r}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class un{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,i,r){this.type=2,this._$AH=H,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=r,this._$Cv=(r==null?void 0:r.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=pe(this,t,e),tn(t)?t===H||t==null||t===""?(this._$AH!==H&&this._$AR(),this._$AH=H):t!==this._$AH&&t!==ne&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Zc(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==H&&tn(this._$AH)?this._$AA.nextSibling.data=t:this.T(ee.createTextNode(t)),this._$AH=t}$(t){var s;const{values:e,_$litType$:i}=t,r=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=en.createElement(Xr(i.h,i.h[0]),this.options)),i);if(((s=this._$AH)==null?void 0:s._$AD)===r)this._$AH.p(e);else{const o=new tu(r,this),a=o.u(this.options);o.p(e),this.T(a),this._$AH=o}}_$AC(t){let e=cr.get(t.strings);return e===void 0&&cr.set(t.strings,e=new en(t)),e}k(t){Pi(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,r=0;for(const s of t)r===e.length?e.push(i=new un(this.O(Je()),this.O(Je()),this,this.options)):i=e[r],i._$AI(s),r++;r<e.length&&(this._$AR(i&&i._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class Pn{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,r,s){this.type=1,this._$AH=H,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=H}_$AI(t,e=this,i,r){const s=this.strings;let o=!1;if(s===void 0)t=pe(this,t,e,0),o=!tn(t)||t!==this._$AH&&t!==ne,o&&(this._$AH=t);else{const a=t;let c,l;for(t=s[0],c=0;c<s.length-1;c++)l=pe(this,a[i+c],e,c),l===ne&&(l=this._$AH[c]),o||(o=!tn(l)||l!==this._$AH[c]),l===H?t=H:t!==H&&(t+=(l??"")+s[c+1]),this._$AH[c]=l}o&&!r&&this.j(t)}j(t){t===H?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class eu extends Pn{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===H?void 0:t}}class nu extends Pn{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==H)}}class iu extends Pn{constructor(t,e,i,r,s){super(t,e,i,r,s),this.type=5}_$AI(t,e=this){if((t=pe(this,t,e,0)??H)===ne)return;const i=this._$AH,r=t===H&&i!==H||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,s=t!==H&&(i===H||r);r&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class su{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){pe(this,t)}}const ei=Ye.litHtmlPolyfillSupport;ei==null||ei(en,un),(Ye.litHtmlVersions??(Ye.litHtmlVersions=[])).push("3.2.1");const ru=(n,t,e)=>{const i=(e==null?void 0:e.renderBefore)??t;let r=i._$litPart$;if(r===void 0){const s=(e==null?void 0:e.renderBefore)??null;i._$litPart$=r=new un(t.insertBefore(Je(),s),s,void 0,e??{})}return r._$AI(n),r};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let Xt=class extends ye{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e;const t=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=t.firstChild),t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=ru(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return ne}};var Tr;Xt._$litElement$=!0,Xt.finalized=!0,(Tr=globalThis.litElementHydrateSupport)==null||Tr.call(globalThis,{LitElement:Xt});const ni=globalThis.litElementPolyfillSupport;ni==null||ni({LitElement:Xt});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Kr=n=>(t,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(n,t)}):customElements.define(n,t)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ou={attribute:!0,type:String,converter:Bn,reflect:!1,hasChanged:Ni},au=(n=ou,t,e)=>{const{kind:i,metadata:r}=e;let s=globalThis.litPropertyMetadata.get(r);if(s===void 0&&globalThis.litPropertyMetadata.set(r,s=new Map),s.set(e.name,n),i==="accessor"){const{name:o}=e;return{set(a){const c=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,c,n)},init(a){return a!==void 0&&this.P(o,void 0,n),a}}}if(i==="setter"){const{name:o}=e;return function(a){const c=this[o];t.call(this,a),this.requestUpdate(o,c,n)}}throw Error("Unsupported decorator location: "+i)};function me(n){return(t,e)=>typeof e=="object"?au(n,t,e):((i,r,s)=>{const o=r.hasOwnProperty(s);return r.constructor.createProperty(s,o?{...i,wrapped:!0}:i),o?Object.getOwnPropertyDescriptor(r,s):void 0})(n,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Zr(n){return me({...n,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const cu={ATTRIBUTE:1},uu=n=>(...t)=>({_$litDirective$:n,values:t});class lu{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ur=uu(class extends lu{constructor(n){var t;if(super(n),n.type!==cu.ATTRIBUTE||n.name!=="class"||((t=n.strings)==null?void 0:t.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(n){return" "+Object.keys(n).filter(t=>n[t]).join(" ")+" "}update(n,[t]){var i,r;if(this.st===void 0){this.st=new Set,n.strings!==void 0&&(this.nt=new Set(n.strings.join(" ").split(/\s/).filter(s=>s!=="")));for(const s in t)t[s]&&!((i=this.nt)!=null&&i.has(s))&&this.st.add(s);return this.render(t)}const e=n.element.classList;for(const s of this.st)s in t||(e.remove(s),this.st.delete(s));for(const s in t){const o=!!t[s];o===this.st.has(s)||(r=this.nt)!=null&&r.has(s)||(o?(e.add(s),this.st.add(s)):(e.remove(s),this.st.delete(s)))}return ne}});var du=Object.defineProperty,Qr=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,o;s>=0;s--)(o=n[s])&&(r=o(t,e,r)||r);return r&&du(t,e,r),r};class Di extends Xt{constructor(){super(...arguments),this.message={id:"",text:"",sender:"",senderRole:"",timestamp:new Date},this.isUser=!1}createRenderRoot(){return this}render(){const t=this.message.senderRole==="GM",e={flex:!0,"items-start":!0,"gap-3":!0,"w-full":!0,"mt-2":!0,"justify-start":!this.isUser,"flex-row-reverse":this.isUser},i={"px-4":!0,"py-2":!0,"w-fit":!0,"max-w-[80%]":!0,"rounded-lg":!0,"backdrop-blur-lg":!0,"bg-purple-600/70":this.isUser,"text-white":this.isUser,"bg-gray-800/70":!this.isUser,"text-gray-100":!this.isUser,border:!0,"border-purple-500/30":this.isUser,"border-gray-700/50":!this.isUser,flex:!0,"flex-col":!0};return Dt`
      <div class=${ur(e)}>

        <div
          class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center overflow-hidden mt-1 shrink-0"
        >
          <img
            src="${this.message.avatar}"
            alt="Avatar"
            class="w-full h-full object-cover"
          />
        </div>

        <div class=${ur(i)}>

          <div class="inline-flex ${this.isUser?"justify-end":"justify-start"} items-center text-xs w-full">
            <span
              class=${this.isUser?"text-purple-300":"text-gray-400"}
            >
                ${this.message.sender}
            </span>
          </div>

          <p class="break-words whitespace-pre-wrap">${this.message.text}</p>

          <div class="inline-flex justify-between items-center text-xs mt-2 w-full">
            ${t?Dt`
                <span
                class="px-2 py-0.5 mr-4 bg-yellow-500/80 text-white text-center rounded-full font-bold text-xs leading-none"
                >
                    GM
                </span>
                `:Dt`<span></span>`}

            <span
              class=${this.isUser?"text-purple-300":"text-gray-400"}
            >
              ${this.formatTime(this.message.timestamp)}
            </span>
          </div>
        </div>
      </div>
    `}formatTime(t){return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}Qr([me({type:Object})],Di.prototype,"message");Qr([me({type:Boolean})],Di.prototype,"isUser");customElements.define("message-item",Di);var ke={},lr;function hu(){return lr||(lr=1,ke.createCanvas=function(n,t){return Object.assign(document.createElement("canvas"),{width:n,height:t})},ke.createImageData=function(n,t,e){switch(arguments.length){case 0:return new ImageData;case 1:return new ImageData(n);case 2:return new ImageData(n,t);default:return new ImageData(n,t,e)}},ke.loadImage=function(n,t){return new Promise(function(e,i){const r=Object.assign(document.createElement("img"),t);function s(){r.onload=null,r.onerror=null}r.onload=function(){s(),e(r)},r.onerror=function(){s(),i(new Error('Failed to load the image "'+n+'"'))},r.src=n})}),ke}var fu=hu();function _u(n,t=100){const e=fu.createCanvas(t,t),i=e.getContext("2d");e.width=t,e.height=t;const r=i.createLinearGradient(0,0,t,t);r.addColorStop(0,dr()),r.addColorStop(1,dr()),i.fillStyle=r,i.fillRect(0,0,t,t),i.font=`${t/2}px Arial`,i.fillStyle="#FFF",i.textAlign="center",i.textBaseline="middle";const s=n.split(" ").map(o=>o.charAt(0).toUpperCase()).slice(0,2).join("");return i.fillText(s,t/2,t/2),e.toDataURL()}function dr(){const n="0123456789ABCDEF";let t="#";for(let e=0;e<6;e++)t+=n[Math.floor(Math.random()*16)];return t}/*! @license DOMPurify 3.2.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.5/LICENSE */const{entries:Jr,setPrototypeOf:hr,isFrozen:yu,getPrototypeOf:pu,getOwnPropertyDescriptor:mu}=Object;let{freeze:J,seal:ut,create:to}=Object,{apply:gi,construct:Ei}=typeof Reflect<"u"&&Reflect;J||(J=function(t){return t});ut||(ut=function(t){return t});gi||(gi=function(t,e,i){return t.apply(e,i)});Ei||(Ei=function(t,e){return new t(...e)});const vn=tt(Array.prototype.forEach),gu=tt(Array.prototype.lastIndexOf),fr=tt(Array.prototype.pop),Ue=tt(Array.prototype.push),Eu=tt(Array.prototype.splice),Sn=tt(String.prototype.toLowerCase),ii=tt(String.prototype.toString),_r=tt(String.prototype.match),He=tt(String.prototype.replace),xu=tt(String.prototype.indexOf),Au=tt(String.prototype.trim),_t=tt(Object.prototype.hasOwnProperty),Z=tt(RegExp.prototype.test),Ge=Tu(TypeError);function tt(n){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return gi(n,t,i)}}function Tu(n){return function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Ei(n,e)}}function b(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Sn;hr&&hr(n,null);let i=t.length;for(;i--;){let r=t[i];if(typeof r=="string"){const s=e(r);s!==r&&(yu(t)||(t[i]=s),r=s)}n[r]=!0}return n}function Ou(n){for(let t=0;t<n.length;t++)_t(n,t)||(n[t]=null);return n}function jt(n){const t=to(null);for(const[e,i]of Jr(n))_t(n,e)&&(Array.isArray(i)?t[e]=Ou(i):i&&typeof i=="object"&&i.constructor===Object?t[e]=jt(i):t[e]=i);return t}function Ve(n,t){for(;n!==null;){const i=mu(n,t);if(i){if(i.get)return tt(i.get);if(typeof i.value=="function")return tt(i.value)}n=pu(n)}function e(){return null}return e}const yr=J(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),si=J(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ri=J(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),vu=J(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),oi=J(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ru=J(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),pr=J(["#text"]),mr=J(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ai=J(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),gr=J(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Rn=J(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Mu=ut(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Cu=ut(/<%[\w\W]*|[\w\W]*%>/gm),Su=ut(/\$\{[\w\W]*/gm),wu=ut(/^data-[\-\w.\u00B7-\uFFFF]+$/),bu=ut(/^aria-[\-\w]+$/),eo=ut(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Bu=ut(/^(?:\w+script|data):/i),Iu=ut(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),no=ut(/^html$/i),Nu=ut(/^[a-z][.\w]*(-[.\w]+)+$/i);var Er=Object.freeze({__proto__:null,ARIA_ATTR:bu,ATTR_WHITESPACE:Iu,CUSTOM_ELEMENT:Nu,DATA_ATTR:wu,DOCTYPE_NAME:no,ERB_EXPR:Cu,IS_ALLOWED_URI:eo,IS_SCRIPT_OR_DATA:Bu,MUSTACHE_EXPR:Mu,TMPLIT_EXPR:Su});const Fe={element:1,text:3,progressingInstruction:7,comment:8,document:9},Pu=function(){return typeof window>"u"?null:window},Du=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null;const r="data-tt-policy-suffix";e&&e.hasAttribute(r)&&(i=e.getAttribute(r));const s="dompurify"+(i?"#"+i:"");try{return t.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},xr=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function io(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Pu();const t=M=>io(M);if(t.version="3.2.5",t.removed=[],!n||!n.document||n.document.nodeType!==Fe.document||!n.Element)return t.isSupported=!1,t;let{document:e}=n;const i=e,r=i.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:c,NodeFilter:l,NamedNodeMap:u=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:d,DOMParser:_,trustedTypes:m}=n,p=c.prototype,f=Ve(p,"cloneNode"),A=Ve(p,"remove"),C=Ve(p,"nextSibling"),S=Ve(p,"childNodes"),R=Ve(p,"parentNode");if(typeof o=="function"){const M=e.createElement("template");M.content&&M.content.ownerDocument&&(e=M.content.ownerDocument)}let y,g="";const{implementation:x,createNodeIterator:T,createDocumentFragment:v,getElementsByTagName:B}=e,{importNode:w}=i;let N=xr();t.isSupported=typeof Jr=="function"&&typeof R=="function"&&x&&x.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:xt,ERB_EXPR:ie,TMPLIT_EXPR:ge,DATA_ATTR:so,ARIA_ATTR:ro,IS_SCRIPT_OR_DATA:oo,ATTR_WHITESPACE:$i,CUSTOM_ELEMENT:ao}=Er;let{IS_ALLOWED_URI:ki}=Er,k=null;const Ui=b({},[...yr,...si,...ri,...oi,...pr]);let V=null;const Hi=b({},[...mr,...ai,...gr,...Rn]);let $=Object.seal(to(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ee=null,Ln=null,Gi=!0,$n=!0,Vi=!1,Fi=!0,se=!1,kn=!0,$t=!1,Un=!1,Hn=!1,re=!1,ln=!1,dn=!1,Wi=!0,ji=!1;const co="user-content-";let Gn=!0,xe=!1,oe={},ae=null;const qi=b({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let zi=null;const Yi=b({},["audio","video","img","source","image","track"]);let Vn=null;const Xi=b({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),hn="http://www.w3.org/1998/Math/MathML",fn="http://www.w3.org/2000/svg",At="http://www.w3.org/1999/xhtml";let ce=At,Fn=!1,Wn=null;const uo=b({},[hn,fn,At],ii);let _n=b({},["mi","mo","mn","ms","mtext"]),yn=b({},["annotation-xml"]);const lo=b({},["title","style","font","a","script"]);let Ae=null;const ho=["application/xhtml+xml","text/html"],fo="text/html";let U=null,ue=null;const _o=e.createElement("form"),Ki=function(h){return h instanceof RegExp||h instanceof Function},jn=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ue&&ue===h)){if((!h||typeof h!="object")&&(h={}),h=jt(h),Ae=ho.indexOf(h.PARSER_MEDIA_TYPE)===-1?fo:h.PARSER_MEDIA_TYPE,U=Ae==="application/xhtml+xml"?ii:Sn,k=_t(h,"ALLOWED_TAGS")?b({},h.ALLOWED_TAGS,U):Ui,V=_t(h,"ALLOWED_ATTR")?b({},h.ALLOWED_ATTR,U):Hi,Wn=_t(h,"ALLOWED_NAMESPACES")?b({},h.ALLOWED_NAMESPACES,ii):uo,Vn=_t(h,"ADD_URI_SAFE_ATTR")?b(jt(Xi),h.ADD_URI_SAFE_ATTR,U):Xi,zi=_t(h,"ADD_DATA_URI_TAGS")?b(jt(Yi),h.ADD_DATA_URI_TAGS,U):Yi,ae=_t(h,"FORBID_CONTENTS")?b({},h.FORBID_CONTENTS,U):qi,Ee=_t(h,"FORBID_TAGS")?b({},h.FORBID_TAGS,U):{},Ln=_t(h,"FORBID_ATTR")?b({},h.FORBID_ATTR,U):{},oe=_t(h,"USE_PROFILES")?h.USE_PROFILES:!1,Gi=h.ALLOW_ARIA_ATTR!==!1,$n=h.ALLOW_DATA_ATTR!==!1,Vi=h.ALLOW_UNKNOWN_PROTOCOLS||!1,Fi=h.ALLOW_SELF_CLOSE_IN_ATTR!==!1,se=h.SAFE_FOR_TEMPLATES||!1,kn=h.SAFE_FOR_XML!==!1,$t=h.WHOLE_DOCUMENT||!1,re=h.RETURN_DOM||!1,ln=h.RETURN_DOM_FRAGMENT||!1,dn=h.RETURN_TRUSTED_TYPE||!1,Hn=h.FORCE_BODY||!1,Wi=h.SANITIZE_DOM!==!1,ji=h.SANITIZE_NAMED_PROPS||!1,Gn=h.KEEP_CONTENT!==!1,xe=h.IN_PLACE||!1,ki=h.ALLOWED_URI_REGEXP||eo,ce=h.NAMESPACE||At,_n=h.MATHML_TEXT_INTEGRATION_POINTS||_n,yn=h.HTML_INTEGRATION_POINTS||yn,$=h.CUSTOM_ELEMENT_HANDLING||{},h.CUSTOM_ELEMENT_HANDLING&&Ki(h.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&($.tagNameCheck=h.CUSTOM_ELEMENT_HANDLING.tagNameCheck),h.CUSTOM_ELEMENT_HANDLING&&Ki(h.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&($.attributeNameCheck=h.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),h.CUSTOM_ELEMENT_HANDLING&&typeof h.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&($.allowCustomizedBuiltInElements=h.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),se&&($n=!1),ln&&(re=!0),oe&&(k=b({},pr),V=[],oe.html===!0&&(b(k,yr),b(V,mr)),oe.svg===!0&&(b(k,si),b(V,ai),b(V,Rn)),oe.svgFilters===!0&&(b(k,ri),b(V,ai),b(V,Rn)),oe.mathMl===!0&&(b(k,oi),b(V,gr),b(V,Rn))),h.ADD_TAGS&&(k===Ui&&(k=jt(k)),b(k,h.ADD_TAGS,U)),h.ADD_ATTR&&(V===Hi&&(V=jt(V)),b(V,h.ADD_ATTR,U)),h.ADD_URI_SAFE_ATTR&&b(Vn,h.ADD_URI_SAFE_ATTR,U),h.FORBID_CONTENTS&&(ae===qi&&(ae=jt(ae)),b(ae,h.FORBID_CONTENTS,U)),Gn&&(k["#text"]=!0),$t&&b(k,["html","head","body"]),k.table&&(b(k,["tbody"]),delete Ee.tbody),h.TRUSTED_TYPES_POLICY){if(typeof h.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ge('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof h.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ge('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');y=h.TRUSTED_TYPES_POLICY,g=y.createHTML("")}else y===void 0&&(y=Du(m,r)),y!==null&&typeof g=="string"&&(g=y.createHTML(""));J&&J(h),ue=h}},Zi=b({},[...si,...ri,...vu]),Qi=b({},[...oi,...Ru]),yo=function(h){let E=R(h);(!E||!E.tagName)&&(E={namespaceURI:ce,tagName:"template"});const O=Sn(h.tagName),P=Sn(E.tagName);return Wn[h.namespaceURI]?h.namespaceURI===fn?E.namespaceURI===At?O==="svg":E.namespaceURI===hn?O==="svg"&&(P==="annotation-xml"||_n[P]):!!Zi[O]:h.namespaceURI===hn?E.namespaceURI===At?O==="math":E.namespaceURI===fn?O==="math"&&yn[P]:!!Qi[O]:h.namespaceURI===At?E.namespaceURI===fn&&!yn[P]||E.namespaceURI===hn&&!_n[P]?!1:!Qi[O]&&(lo[O]||!Zi[O]):!!(Ae==="application/xhtml+xml"&&Wn[h.namespaceURI]):!1},pt=function(h){Ue(t.removed,{element:h});try{R(h).removeChild(h)}catch{A(h)}},pn=function(h,E){try{Ue(t.removed,{attribute:E.getAttributeNode(h),from:E})}catch{Ue(t.removed,{attribute:null,from:E})}if(E.removeAttribute(h),h==="is")if(re||ln)try{pt(E)}catch{}else try{E.setAttribute(h,"")}catch{}},Ji=function(h){let E=null,O=null;if(Hn)h="<remove></remove>"+h;else{const F=_r(h,/^[\r\n\t ]+/);O=F&&F[0]}Ae==="application/xhtml+xml"&&ce===At&&(h='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+h+"</body></html>");const P=y?y.createHTML(h):h;if(ce===At)try{E=new _().parseFromString(P,Ae)}catch{}if(!E||!E.documentElement){E=x.createDocument(ce,"template",null);try{E.documentElement.innerHTML=Fn?g:P}catch{}}const q=E.body||E.documentElement;return h&&O&&q.insertBefore(e.createTextNode(O),q.childNodes[0]||null),ce===At?B.call(E,$t?"html":"body")[0]:$t?E.documentElement:q},ts=function(h){return T.call(h.ownerDocument||h,h,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT|l.SHOW_PROCESSING_INSTRUCTION|l.SHOW_CDATA_SECTION,null)},qn=function(h){return h instanceof d&&(typeof h.nodeName!="string"||typeof h.textContent!="string"||typeof h.removeChild!="function"||!(h.attributes instanceof u)||typeof h.removeAttribute!="function"||typeof h.setAttribute!="function"||typeof h.namespaceURI!="string"||typeof h.insertBefore!="function"||typeof h.hasChildNodes!="function")},es=function(h){return typeof a=="function"&&h instanceof a};function Tt(M,h,E){vn(M,O=>{O.call(t,h,E,ue)})}const ns=function(h){let E=null;if(Tt(N.beforeSanitizeElements,h,null),qn(h))return pt(h),!0;const O=U(h.nodeName);if(Tt(N.uponSanitizeElement,h,{tagName:O,allowedTags:k}),h.hasChildNodes()&&!es(h.firstElementChild)&&Z(/<[/\w!]/g,h.innerHTML)&&Z(/<[/\w!]/g,h.textContent)||h.nodeType===Fe.progressingInstruction||kn&&h.nodeType===Fe.comment&&Z(/<[/\w]/g,h.data))return pt(h),!0;if(!k[O]||Ee[O]){if(!Ee[O]&&ss(O)&&($.tagNameCheck instanceof RegExp&&Z($.tagNameCheck,O)||$.tagNameCheck instanceof Function&&$.tagNameCheck(O)))return!1;if(Gn&&!ae[O]){const P=R(h)||h.parentNode,q=S(h)||h.childNodes;if(q&&P){const F=q.length;for(let et=F-1;et>=0;--et){const mt=f(q[et],!0);mt.__removalCount=(h.__removalCount||0)+1,P.insertBefore(mt,C(h))}}}return pt(h),!0}return h instanceof c&&!yo(h)||(O==="noscript"||O==="noembed"||O==="noframes")&&Z(/<\/no(script|embed|frames)/i,h.innerHTML)?(pt(h),!0):(se&&h.nodeType===Fe.text&&(E=h.textContent,vn([xt,ie,ge],P=>{E=He(E,P," ")}),h.textContent!==E&&(Ue(t.removed,{element:h.cloneNode()}),h.textContent=E)),Tt(N.afterSanitizeElements,h,null),!1)},is=function(h,E,O){if(Wi&&(E==="id"||E==="name")&&(O in e||O in _o))return!1;if(!($n&&!Ln[E]&&Z(so,E))){if(!(Gi&&Z(ro,E))){if(!V[E]||Ln[E]){if(!(ss(h)&&($.tagNameCheck instanceof RegExp&&Z($.tagNameCheck,h)||$.tagNameCheck instanceof Function&&$.tagNameCheck(h))&&($.attributeNameCheck instanceof RegExp&&Z($.attributeNameCheck,E)||$.attributeNameCheck instanceof Function&&$.attributeNameCheck(E))||E==="is"&&$.allowCustomizedBuiltInElements&&($.tagNameCheck instanceof RegExp&&Z($.tagNameCheck,O)||$.tagNameCheck instanceof Function&&$.tagNameCheck(O))))return!1}else if(!Vn[E]){if(!Z(ki,He(O,$i,""))){if(!((E==="src"||E==="xlink:href"||E==="href")&&h!=="script"&&xu(O,"data:")===0&&zi[h])){if(!(Vi&&!Z(oo,He(O,$i,"")))){if(O)return!1}}}}}}return!0},ss=function(h){return h!=="annotation-xml"&&_r(h,ao)},rs=function(h){Tt(N.beforeSanitizeAttributes,h,null);const{attributes:E}=h;if(!E||qn(h))return;const O={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:V,forceKeepAttr:void 0};let P=E.length;for(;P--;){const q=E[P],{name:F,namespaceURI:et,value:mt}=q,Te=U(F);let Y=F==="value"?mt:Au(mt);if(O.attrName=Te,O.attrValue=Y,O.keepAttr=!0,O.forceKeepAttr=void 0,Tt(N.uponSanitizeAttribute,h,O),Y=O.attrValue,ji&&(Te==="id"||Te==="name")&&(pn(F,h),Y=co+Y),kn&&Z(/((--!?|])>)|<\/(style|title)/i,Y)){pn(F,h);continue}if(O.forceKeepAttr||(pn(F,h),!O.keepAttr))continue;if(!Fi&&Z(/\/>/i,Y)){pn(F,h);continue}se&&vn([xt,ie,ge],as=>{Y=He(Y,as," ")});const os=U(h.nodeName);if(is(os,Te,Y)){if(y&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!et)switch(m.getAttributeType(os,Te)){case"TrustedHTML":{Y=y.createHTML(Y);break}case"TrustedScriptURL":{Y=y.createScriptURL(Y);break}}try{et?h.setAttributeNS(et,F,Y):h.setAttribute(F,Y),qn(h)?pt(h):fr(t.removed)}catch{}}}Tt(N.afterSanitizeAttributes,h,null)},po=function M(h){let E=null;const O=ts(h);for(Tt(N.beforeSanitizeShadowDOM,h,null);E=O.nextNode();)Tt(N.uponSanitizeShadowNode,E,null),ns(E),rs(E),E.content instanceof s&&M(E.content);Tt(N.afterSanitizeShadowDOM,h,null)};return t.sanitize=function(M){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=null,O=null,P=null,q=null;if(Fn=!M,Fn&&(M="<!-->"),typeof M!="string"&&!es(M))if(typeof M.toString=="function"){if(M=M.toString(),typeof M!="string")throw Ge("dirty is not a string, aborting")}else throw Ge("toString is not a function");if(!t.isSupported)return M;if(Un||jn(h),t.removed=[],typeof M=="string"&&(xe=!1),xe){if(M.nodeName){const mt=U(M.nodeName);if(!k[mt]||Ee[mt])throw Ge("root node is forbidden and cannot be sanitized in-place")}}else if(M instanceof a)E=Ji("<!---->"),O=E.ownerDocument.importNode(M,!0),O.nodeType===Fe.element&&O.nodeName==="BODY"||O.nodeName==="HTML"?E=O:E.appendChild(O);else{if(!re&&!se&&!$t&&M.indexOf("<")===-1)return y&&dn?y.createHTML(M):M;if(E=Ji(M),!E)return re?null:dn?g:""}E&&Hn&&pt(E.firstChild);const F=ts(xe?M:E);for(;P=F.nextNode();)ns(P),rs(P),P.content instanceof s&&po(P.content);if(xe)return M;if(re){if(ln)for(q=v.call(E.ownerDocument);E.firstChild;)q.appendChild(E.firstChild);else q=E;return(V.shadowroot||V.shadowrootmode)&&(q=w.call(i,q,!0)),q}let et=$t?E.outerHTML:E.innerHTML;return $t&&k["!doctype"]&&E.ownerDocument&&E.ownerDocument.doctype&&E.ownerDocument.doctype.name&&Z(no,E.ownerDocument.doctype.name)&&(et="<!DOCTYPE "+E.ownerDocument.doctype.name+`>
`+et),se&&vn([xt,ie,ge],mt=>{et=He(et,mt," ")}),y&&dn?y.createHTML(et):et},t.setConfig=function(){let M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};jn(M),Un=!0},t.clearConfig=function(){ue=null,Un=!1},t.isValidAttribute=function(M,h,E){ue||jn({});const O=U(M),P=U(h);return is(O,P,E)},t.addHook=function(M,h){typeof h=="function"&&Ue(N[M],h)},t.removeHook=function(M,h){if(h!==void 0){const E=gu(N[M],h);return E===-1?void 0:Eu(N[M],E,1)[0]}return fr(N[M])},t.removeHooks=function(M){N[M]=[]},t.removeAllHooks=function(){N=xr()},t}var Ar=io(),Lu=Object.defineProperty,$u=Object.getOwnPropertyDescriptor,Dn=(n,t,e,i)=>{for(var r=i>1?void 0:i?$u(t,e):t,s=n.length-1,o;s>=0;s--)(o=n[s])&&(r=(i?o(t,e,r):o(r))||r);return i&&r&&Lu(t,e,r),r};let nn=class extends Xt{constructor(){super(),this.messages=[],this.inputValue="",this.cacheAvatar="",this.messages=[]}connectedCallback(){super.connectedCallback(),L.onReady(async()=>{L.broadcast.onMessage("cthulhu.message",async n=>{const t=n.data;typeof t.timestamp=="string"&&(t.timestamp=new Date(t.timestamp)),t.senderRole==="GM"&&await L.notification.show("Nuevo mensaje del GameMaster","INFO"),t.text=Ar.sanitize(t.text),this.messages=[...this.messages,t],this.requestUpdate()})})}createRenderRoot(){return this}render(){return Dt`
      <div class="flex flex-col min-h-screen text-gray-100 relative">
        <div class="border-b border-gray-700 p-4">
          <h1 class="text-xl font-semibold text-white">Chat</h1>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-4 mb-16" id="message-container">
          ${this.messages.map(n=>Dt`
              <message-item
                .message=${n}
                .isUser=${n.isOwner}
              ></message-item>
            `)}
        </div>

        <div class="absolute bottom-0 left-0 w-full p-4 bg-gray-800/30 backdrop-blur-md border-t border-gray-700/50">
          <form @submit=${this.handleSubmit} class="flex space-x-2">
            <input
              type="text"
              .value=${this.inputValue}
              @input=${n=>{const t=n.target;this.inputValue=t.value}}
              placeholder="Escribe un mensaje..."
              class="flex-1 px-4 py-2 bg-gray-700/50 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 text-white placeholder-gray-400"
            />
            <button
              type="submit"
              class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500"
            >
              Enviar
            </button>
          </form>
        </div>
      </div>
    `}async handleSubmit(n){if(n.preventDefault(),!this.inputValue.trim())return;const t=await L.player.getName(),e=await L.player.getRole()==="GM",i=await this.getUserAvatar(t),r={id:Date.now().toString(),text:this.inputValue,senderRole:e?"GM":"USER",sender:t,avatar:i,timestamp:new Date,isOwner:!0};r.text=Ar.sanitize(r.text),this.messages=[...this.messages,r],this.inputValue="";const s={...r,isOwner:!1};L.broadcast.sendMessage("cthulhu.message",s)}async getUserAvatar(n){return this.cacheAvatar||(this.cacheAvatar=_u(n)),this.cacheAvatar}};Dn([me({type:Array})],nn.prototype,"messages",2);Dn([me({type:String})],nn.prototype,"inputValue",2);Dn([me({type:String})],nn.prototype,"cacheAvatar",2);nn=Dn([Kr("chat-windows")],nn);var ku=Object.defineProperty,Uu=Object.getOwnPropertyDescriptor,Li=(n,t,e,i)=>{for(var r=i>1?void 0:i?Uu(t,e):t,s=n.length-1,o;s>=0;s--)(o=n[s])&&(r=(i?o(t,e,r):o(r))||r);return i&&r&&ku(t,e,r),r};let sn=class extends Xt{constructor(){super(...arguments),this.imageUrl=null,this.loaded=!1}connectedCallback(){super.connectedCallback();const t=new URLSearchParams(window.location.search).get("image");if(t){const e=decodeURIComponent(t),i=new Image;i.src=e,i.onload=()=>{this.imageUrl=e,this.loaded=!0},i.onerror=()=>{console.warn("No se pudo cargar la imagen:",e),this.loaded=!0}}}render(){return Dt`
      <div
        class="flex items-center justify-center w-screen h-screen overflow-hidden bg-black bg-opacity-80"
        @click=${()=>L.modal.close("ver-ficha")}
      >
        ${this.loaded&&this.imageUrl?Dt`
          <div style="width: 400px; height: 500px; background-image: url('${this.imageUrl}'); background-size: contain; background-repeat: no-repeat; background-position: center center;">`:Dt`<p class="text-white">Loading...</p>`}
      </div>
    `}};sn.styles=[];Li([Zr()],sn.prototype,"imageUrl",2);Li([Zr()],sn.prototype,"loaded",2);sn=Li([Kr("modal-image")],sn);
